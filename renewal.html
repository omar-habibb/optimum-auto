<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <title>Renewal - Optimum Auto</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"> 
  <style>
     
    
  .fContainer{
      width:100%;
     
      min-height: 825px;
      padding: 25px;
      border-radius: 10px;
      flex: 1;
      background-image: linear-gradient(black 1%,goldenrod , black 98%);
      display: flex;
      align-items: center;
      justify-content: center;
      
  }
  input{
      width: 90%;
      padding: 10px;
      margin: 10px 10px;
      border: 3px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
      
    }
    label{
      margin-left:10px ;
    }
     #endDateDisplay {
      font-weight: 500;
      padding: 10px;
      margin: 10px 10px;
      border: 3px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
      color:rgb(10, 10, 10);
      
    }
    select, textarea {
      width: 95%;
      padding: 10px;
      margin: 10px 10px;
      border: 3px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
    }

    #renewal-step-1, #renewal-step-2, #payment-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #f5f5f5;
  border: 1px solid #ddd;
  padding: 15px;
  border-radius: 8px;
  width:100%;
  max-width: 700px;
  height: max-content;
  /*margin-top:20px;
  margin-bottom: 20px;*/
  min-height: 400px;
    }
    #renewal-step-2 p{
      margin: 7px 0;
    }
  #rbtn{
    color:black;
    background-color: gold;
    width: 95%;
      padding: 10px;
      margin: 10px 10px;
      border: none;
      border-radius: 5px;
      font-size: 1.1rem;
  }
  #bbtn{
    color:#ccc;
   background-color:black;
    width: 95%;
      padding: 10px;
      margin: 10px 10px;
      border: none;
      border-radius: 5px;
      font-size: 1.1rem;

  }
  .strike {
    position: relative;
    display: inline-block; /* Or block, depending on your layout */
}

.strike::before {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    top: 48%; /* Adjust as needed for vertical centering */
    border-top:  0.1rem solid black; /* Or background-color */
    transform: rotate(0deg); /* Adjust the angle for tilt */
    transform-origin: center center; /* Ensure rotation around the center */
}

  </style>
</head>
<body style="background-color: black;">
    <!-- Sticky Navigation -->
  <nav class="navbar">
    <div class="container">
              <a href="index.html" class="logo-combo">
  <img src="logo.png" alt="Optimum Auto Logo" class="logo-img" />
  <span class="logo-text">Optimum Auto</span>
</a>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="service.html">Service</a></li>
        <li class="dropdown">
  <a href="#">Membership <i class="fa fa-caret-down"></i></a>
  <ul class="dropdown-content">
    <li><a href="subscribe.html">Subscribe</a></li>
    <li><a href="renewal.html">Renew</a></li>
    <li><a href="pricing.html">Pricing</a></li>
  </ul>
</li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </div>
  </nav>

    <div class="fContainer">
    <!-- Step 1: Input -->
    <div id="renewal-step-1">
      <h2 style="color: goldenrod; margin-bottom: 1.4rem;">Optimum Auto <br>Renewal form </h2>
      
      <form id="renewal-form">
        
        <label for="userId">Your ID</label>
        <input type="text" id="userId" name="userId" required />

        <label for="sixDayCars">Number of Cars (6-Day Plan)</label>
        <input type="number" id="sixDayCars" name="sixDayCars" min="0"  />

        <label for="threeDayCars">Number of Cars (3-Day Plan)</label>
        <input type="number" id="threeDayCars" name="threeDayCars" min="0" />

        <label for="durationSelect" id="rem">Duration:</label>
        <select id="durationSelect" name="duration" required>
        <option value="">Select Duration</option>
        <option value="4">4 Weeks</option>
        </select>

        <label for="startDate"id="rem">Select Start Date:</label>
        <select id="startDate" name="startDate" required>
        
        </select>

        <p style="margin-left:10px;" id="rem">Renewal Date:</p>
        <p id="endDateDisplay" ></p>
       
        <p id="start-note" style="display: none; color: gray; margin-top: 5px; font-size: 0.8rem;">
  Note: If you’d like to add or remove a car, please 
      <a href="https://wa.me/201123403403?text=Hello%2C%20I%20would%20like%20to%20add%2Fremove%20a%20car." style="color: goldenrod;"> message us</a> before proceeding.
</p>
     
        <button type="submit" id="rbtn">Next</button>
      </form>
      <div id="form-warning" style="color: red; margin-top: 10px; display: none;"></div>
    </div>

    <!-- Step 2: Summary -->
    <div id="renewal-step-2" style="display: none;">
        <div style="text-align: center; margin-bottom: 20px;">
      <h2>Renewal Summary</h2>
      <p id="welcome-msg"></p>
      </div>
      <p><strong>-ID:</strong> <span id="summary-user-id">—</span></p>
      <p><strong>-3-Day Plan Cars:</strong> <span id="summary-3day">0</span></p>
      <p><strong>-6-Day Plan Cars:</strong> <span id="summary-6day">0</span></p>
      <p><strong>-Duration:</strong> <span id="summary-duration"></span></p>
      <select id="durationSelect" name="duration" required style="display:none;">
        <option value="">Select Duration</option>
        <option value="4">4 Weeks</option>
        </select>
      <p><strong>-Start Date:</strong> <span id="summary-start-date"></span></p>
      <select id="startDate" name="startDate" required style="display:none;"></select>
      <p><strong>-Next Renewal:</strong> <span id="summary-end-date"></span><p id="endDateDisplay" style="display:none; padding:5px; margin-left: 10px;" ></p></p>
      <p><strong>-Standard Price:</strong> <span id="original-price">EGP 0</span></p>
      <p><strong>-Special Price:</strong> <span id="total-price">EGP 0</span></p>
      <p id="summary-note" style="display: none; color: gray; margin-top: 10px; font-size: 0.8rem;">
      Note: If you’d like to add or remove a car, please 
      <a href="https://wa.me/201123403403?text=Hello%2C%20I%20would%20like%20to%20add%2Fremove%20a%20car." style="color: goldenrod;">message us</a> before proceeding.
      </p>
      <button onclick="handleProceed()" id="rbtn">Proceed to Payment</button>
      <button onclick="goBack()" id="bbtn">Back</button>
    </div>

    <!-- Payment loading screen -->
<div id="payment-loading" style="display: none;">
  <h2>Loading Payment Gateway...</h2>
</div>
  </div>

  <!-- Footer -->
  <footer class="bg-black text-white py-8">
    <div class="containerft text-center">
      <p>&copy; <span id="year"></span> Optimum Auto. All rights reserved.</p>
    </div>

<p>
    <i class="fa-solid fa-location-dot" style="color:gold;"></i>
    Cairo, Egypt</p>

    <!-- Policy Toggle Buttons -->
    <div class="policy-buttons flex flex-wrap justify-center gap-3 mb-4">
      <button type="button" class="footer-policy-btn">Privacy Policy</button>
      <button type="button" class="footer-policy-btn">Refund & Exchange</button>
      <button type="button" class="footer-policy-btn">Terms & Conditions</button>
    </div>

    <!-- Policy Content Sections -->
     <!--privacy-->
<div class="policy-container">
  <div class="policy-item">
    <div class="policy-content hidden">
      
      <h3>Privacy Policy</h3>
      <p>
        At Optimum Auto, your privacy is important to us. This Privacy Policy outlines how we collect, use, and protect your personal information when you use our services.
      </p>
      <h4>Information We Collect</h4>
      <p>
        We collect only the information necessary to deliver our services effectively and securely:
      </p>
      <ul>
        <li>-Full Name</li>
        <li>-Phone Number</li>
        <li>-Address</li>
        <li>-Car Details</li>
        <li>-Number of Cars</li>
      </ul>
      <h4>How We Use Your Information</h4>
      <p>
        Your data is used strictly for operational purposes:
      </p>
      <ul>
        <li>-To manage your car wash subscription</li>
        <li>-To schedule and deliver service to your specified location</li>
        <li>-To send service-related notifications (e.g., reminders or updates) via WhatsApp</li>
        <li>-To process payments securely through our payment provider (see below)</li>
      </ul>
      <p>
        We do not send promotional content and we do not share your information with any third parties.
      </p>
      <h4>Payment Processing</h4>
      <P>
        When you complete a payment through our platform, a limited set of billing data is securely shared with our payment provider, Paymob, for transaction processing purposes. This includes:
      </P>
      <ul>
        <li>-First Name</li>
        <li>-Last Name</li>
        <li>-Phone Number</li>
        <li>-BUilding Number</li>
      </ul>
      <p>
        This data is used solely to identify the payment and ensure proper service delivery. It is not used for marketing or any other purposes.
      </p>
      <h4>Data Storage & Security</h4>
      <p>
        All user data is stored in protected files and handled with confidentiality. We do not use cookies or third-party trackers. Some data may be stored in your browser’s local storage for smoother interaction on our website — none of this is shared externally.
      </p>
      <h4>Your Rights</h4>
      <p>You have full control over your data:</p>
      <ul>
        <li>-You may request to update or correct your information at any time.</li>
        <li>-You may request to delete your data from our system.</li>
      </ul>
      <p>To do so, simply contact us via WhatsApp or email.</p>
      <h4>Policy Updates</h4>
      <p>We may update this Privacy Policy if needed to reflect changes in service. We will notify you of any major updates.</p>
      <br>
      <h5>If you have any questions or concerns regarding your privacy, feel free to reach out to us via the methods listed on our  <a href="contact.html" style="color: goldenrod;">Contact Page.</a></h5>
      <button id="fc-btn" onclick="cl()">Accept</button>
    </div>
  </div>

  <div class="policy-item">
    <div class="policy-content hidden">
      <h3>Refund & Exchange Policy</h3>
      <P>
        At Optimum Auto, we aim to provide a seamless and reliable service. To ensure transparency and fairness. Please review the following terms regarding refunds and subscription changes:
      </P>
      <h4>Refunds</h4>
      <p>
        <strong>Payment Errors:</strong> If a customer is charged incorrectly due to a system or billing error, a full refund will be issued upon verification.
      </p>
      <p>
        <strong>Cancellation Within First 2 Weeks:</strong> If a customer chooses to cancel their subscription within 14 days from the start date, they are eligible for a refund of 50% of the total amount paid.
      </p>
      <p>
        <strong>Cancellation After 2 Weeks:</strong> Requests for cancellation made after the initial two-week period from the start date are not eligible for a refund.
      </p>
      <h4>Plan Changes</h4>
      <p>
        <strong>Upgrading from 3-Day to 6-Day Plan:</strong>
        <br>-Customers may upgrade their plan within 7 days of the subscription start date, with the price difference applied accordingly.
        <br>-After this period, upgrades can still be made, but we recommend scheduling them for the upcoming month, as it would be more cost-effective for the customer.
        <br>-The upgraded plan will be applied starting from the following week to ensure proper planning and availability.
      </p>
      <p>
        <strong>Downgrading from 6-Day to 3-Day Plan:</strong>
        <br>-Downgrades can be requested within the first 3 days of the subscription start date for a refund of the price difference.
        <br>-After that, customers may still downgrade at any time, but no refund will be issued. It is recommended to apply such changes for the upcoming month.
        <br>-The change to the downgraded plan will be processed and applied instantly after confirmation.
      </p>
      <h4>Missed Washes</h4>
      <p>
        We strive to maintain reliable service and consistent scheduling. In the rare case that a wash cannot be completed due to unexpected or uncontrollable circumstances (such as weather or logistical challenges), we will notify the customer in advance via WhatsApp, and do our best to minimize any disruption to the service. Our team always aims to operate with professionalism and transparency.
      </p>
      <br>
      <h5>For any refund or exchange inquiries, feel free to reach out to us via the methods listed on our <a href="contact.html" style="color: goldenrod;">Contact Page.</a></h5>
      <button id="fc-btn" onclick="cl()">Accept</button>
    </div>
  </div>


  <div class="policy-item">
    <div class="policy-content hidden">

      <h4>🚘 Optimum Auto – Service Terms & What You Should Know</h4>
    <p>To keep your experience smooth and your car looking its best, here are a few simple things to know before each wash. Nothing complicated — just easy steps to help us deliver the best results.</p>

    <h4>✅ What You Should Do</h4>
    <ul>
      <li>-Please make sure all windows, sunroof, trunk, and hood are closed.</li>
      <li>-Park your car within one building to the left or right of your registered address.</li>
      <li>-If your car’s color or license plate has changed, just let us know on WhatsApp.</li>
      <li>-Our team will wash your car at any time within the time your car will be available from and the time it needs to be done by. 
      If the car will arrive later or needs to be used earlier than that time frame, please notify us before 10:00 PM on the same day via WhatsApp.</li>
    </ul>

    <h4>⚠️ When We Can’t Wash the Car</h4>
    <ul>
      <li>-Open windows, sunroof, trunk, or hood at the time of service.</li>
      <li>-Car is parked outside the allowed area (not within one building of your location).</li>
      <li>-License plate or color changed without prior notice.</li>
      <li>-Car is in a garage with direct building access.</li>
      <li>-Car is not present during the time range provided, and we were not informed before 10:00 PM.</li>
      <li>-Rainy weather that prevents safe washing.</li>
    </ul>

    <h4>📱 Communication</h4>
    <p>All service-related updates, changes, or notifications will be sent through WhatsApp. Please make sure your number is active and reachable.</p>
    <br>
    <h5>For any questions, issues, or feedback,  feel free to reach out to us via the methods listed on our <a href="contact.html" style="color: goldenrod;">Contact Page.</a></h5>
    <button id="fc-btn" onclick="cl()">Accept</button>
    </div>
  </div>
</div>

</footer>


<script>

    //accept policy
function cl(){
  const policies = document.querySelectorAll(".policy-content");
  policies.forEach(policy => {
    policy.classList.add("hidden");
    });

}
//policies
document.querySelectorAll(".footer-policy-btn").forEach((btn, index) => {
  btn.addEventListener("click", () => {
    const policies = document.querySelectorAll(".policy-content");
    
    // Hide all policy sections first
    policies.forEach(policy => {
      policy.classList.add("hidden");
    });

    // Show the one that matches the clicked button
    if (policies[index]) {
      policies[index].classList.remove("hidden");
    }
  });
});
//year
document.getElementById("year").textContent = new Date().getFullYear();

// Your existing calculatePrice function
    function calculatePrice(cars = []) {
      let totalPrice = 0;
      let originalPrice = 0;

      const sixDayCars = cars.filter(c => c.plan === "6");
      const threeDayCars = cars.filter(c => c.plan === "3");

      if(sixDayCars.length === 1 && threeDayCars.length === 1 ){
      totalPrice += 1150;
      originalPrice += 1200;
    } else if(sixDayCars.length >= 2 && threeDayCars.length === 1){
      totalPrice +=  (sixDayCars.length * 600 ) + 400 ;
      originalPrice += (sixDayCars.length * 750 ) + 450;
    }else if(sixDayCars.length === 1 && threeDayCars.length >= 2){
      totalPrice += (threeDayCars.length * 350 ) + 700;
      originalPrice += (threeDayCars.length * 450 ) + 750;
    }else{
    if (sixDayCars.length === 1) {
      totalPrice += 750;
      originalPrice += 750;
    } else if (sixDayCars.length >= 2) {
      totalPrice += 600 * sixDayCars.length;
      originalPrice += 750 * sixDayCars.length;
    } 

    if (threeDayCars.length === 1) {
      totalPrice += 450;
      originalPrice += 450;
    } else if (threeDayCars.length >= 2) {
      totalPrice += 350 * threeDayCars.length;
      originalPrice += 450 * threeDayCars.length;
    } 
    }

      return {
        totalPrice: parseFloat(totalPrice.toFixed(2)),
        originalPrice: parseFloat(originalPrice.toFixed(2))
      };
    }

    // Step handling logic
    document.getElementById("renewal-form").addEventListener("submit", function (e) {
      e.preventDefault();

      const threeDayCars = parseInt(document.getElementById("threeDayCars").value) || 0;
      const sixDayCars = parseInt(document.getElementById("sixDayCars").value) || 0;

       // ✅ Stop the process if both are zero
 if (threeDayCars + sixDayCars === 0) {
  const warning = document.getElementById("form-warning");
  warning.textContent = "🚫 Please enter at least one car in either plan.";
  warning.style.display = "block";
  return;
} else {
  // Clear warning if valid
  document.getElementById("form-warning").style.display = "none";
}


      const cars = [];

      for (let i = 0; i < threeDayCars; i++) {
        cars.push({ plan: "3" });
      }
      for (let i = 0; i < sixDayCars; i++) {
        cars.push({ plan: "6" });
      }
      const userId = document.getElementById("userId").value;
      
      const startDateInput = document.getElementById("startDate").value;
      const startDate = new Date(startDateInput);
      const formattedDate =startDate.toLocaleDateString("en-US", {year: "numeric",month: "long",day: "numeric"});
      const durationInput = document.getElementById("durationSelect").value;
      const endDateInput = startDate +  (durationInput*7*24*60*60*1000);
      const daysToAdd = (durationInput * 7)-1 ;
      const endDate = new Date(startDateInput);
      endDate.setDate(startDate.getDate() + daysToAdd);
      const formattedEndDate =endDate.toLocaleDateString("en-US", {year: "numeric",month: "long",day: "numeric"});


      const params = new URLSearchParams(window.location.search);
  const id = params.get("id");
  const three = parseInt(params.get("three") || "0");
  const six = parseInt(params.get("six") || "0");
       

      const { totalPrice, originalPrice } = calculatePrice(cars);
      
      document.getElementById("summary-user-id").textContent = userId;
      document.getElementById("summary-3day").textContent = threeDayCars;
      document.getElementById("summary-6day").textContent = sixDayCars;
      if (!(id && (three > 0 || six > 0))) {
      document.getElementById("summary-duration").textContent = `${durationInput} Weeks`;
      document.getElementById("summary-start-date").textContent = formattedDate;
      document.getElementById("summary-end-date").textContent =formattedEndDate;
      
      }else{
        /*document.getElementById("summary-duration").innerHTML = `<select id="durationSelect" name="duration" required>
        <option value="">Select Duration</option>
        <option value="4">4 Weeks</option>
        </select>`;*/
        //document.getElementById("summary-start-date").innerHTML = `<select id="startDate" name="startDate" required></select>`;
        
      }
      if(originalPrice === totalPrice){
      document.getElementById("original-price").textContent = `${originalPrice} EGP `;
      document.getElementById("total-price").innerHTML = `<i class="fa-solid fa-xmark" style="margin-left:10px;font-size:1.1rem;" ></i>`;
      }else{
        document.getElementById("original-price").innerHTML = `<span class="strike">${originalPrice} EGP</span>`;
      document.getElementById("total-price").textContent = `${totalPrice} EGP `;
      
      }
      // Save data to localStorage
      localStorage.setItem("optimumUserId", userId);
      localStorage.setItem("optimumThreeDayCars", threeDayCars);
      localStorage.setItem("optimumSixDayCars", sixDayCars);
      localStorage.setItem("optimumStartDate", startDateInput);


      document.getElementById("renewal-step-1").style.display = "none";
      document.getElementById("renewal-step-2").style.display = "block";
    });


   /*function calcorder(){
    const threeDayCars = parseInt(document.getElementById("threeDayCars").value) || 0;
      const sixDayCars = parseInt(document.getElementById("sixDayCars").value) || 0;
     const cars = [];

      for (let i = 0; i < threeDayCars; i++) {
        cars.push({ plan: "3" });
      }
      for (let i = 0; i < sixDayCars; i++) {
        cars.push({ plan: "6" });
      }
      
    const { totalPrice, originalPrice } = calculatePrice(cars);
    
    return totalPrice;

   }*/

    async function proceedToPayment() {
  const id = document.getElementById("userId").value;
  const totalPrice = document.getElementById("total-price").textContent.replace("EGP", "").trim();
  const amount = parseFloat(totalPrice) * 100;

  try {
    const response = await fetch("https://ren-paymob-backend-production.up.railway.app/start-renewal", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ amount, id })
    });

    const result = await response.json();

    if (result.checkout_url) {
      window.location.href = result.checkout_url;
      //window.open(result.checkout_url, "_blank");
    } else {
      alert("Payment failed: " + result.error);
    }

  } catch (err) {
    console.error("Checkout error:", err);
    alert("Could not start checkout.");
  }


}



async function sendDataToSheet() {
  const userId = document.getElementById("userId").value;
  const threeDayCars = parseInt(document.getElementById("threeDayCars").value) || 0;
  const sixDayCars = parseInt(document.getElementById("sixDayCars").value) || 0;
  const startDateInput = document.getElementById("startDate").value;
  const duration = document.getElementById("durationSelect").value;
  const startDate = new Date(startDateInput);
  const formattedStartDate = `${String(startDate.getDate()).padStart(2, '0')}/${String(startDate.getMonth() + 1).padStart(2, '0')}/${startDate.getFullYear()}`;

  const totalPrice = document.getElementById("total-price").textContent.replace("EGP", "").trim();

  const payload = {
    userId,
    threeDayCars,
    sixDayCars,
    duration,
    startDate: formattedStartDate,
    totalPrice
  };
  try {
      const response = await fetch("https://google-ren-back-production.up.railway.app/renew", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(payload)
})
.then(res => res.json())
.then(data => {
  if (data.success) {
  } else {
    console.error("Failed:", data.error);
  }
});


      
    } catch (error) {
      console.error("Error sending data:", error);
    }
  }
  

function handleProceed() {
  const endDateCheck =document.getElementById("endDateDisplay");
  if(!endDateCheck.textContent){
    alert("Please select a start date and duration first.");
    return;
  }else{
  proceedToPayment();   // handles loading UI
  sendDataToSheet();    // sends form data to Google Sheet
  setTimeout(() => {
      document.getElementById("renewal-step-2").style.display = "block";
      document.getElementById("payment-loading").style.display = "none";
      }, 20000);
  // Hide the summary step
  document.getElementById("renewal-step-2").style.display = "none";

  // Show the payment loading message
  document.getElementById("payment-loading").style.display = "block";

  // Optional: Add a loading spinner or delay here later
  }
}




    function goBack() {
      document.getElementById("renewal-step-2").style.display = "none";
      document.getElementById("renewal-step-1").style.display = "block";
    }


    function getNextFridays(count = 15) {
  const fridays = [];
  const now = new Date();

  let date = new Date(now);

  // Check if today is Friday and before 8 PM
  if (date.getDay() === 5 && date.getHours() < 20) {
    fridays.push(new Date(date)); // Include today
  }

  // Start from tomorrow
  date.setDate(date.getDate() + 1);

  while (fridays.length < count) {
    if (date.getDay() === 5) {
      fridays.push(new Date(date));
    }
    date.setDate(date.getDate() + 1);
  }

  return fridays;
}


const durationSe = document.getElementById("durationSelect");
const startDateSe = document.getElementById("startDate");

  const select = document.querySelector("select[name='startDate']");
  populateFridayOptions(select);

// Function to calculate end date
function calculateEndDate(startDate, weeks) {
  const date = new Date(startDate);
  const daysToAdd = (weeks * 7)-1 ; // end date should be Thursday
  date.setDate(date.getDate() + daysToAdd);
  return date.toLocaleDateString("en-US", {
    
    year: "numeric",
    month: "long",
    day: "numeric"
  });
}

// Function to update end date display
function updateEndDate() {
  const durationSelect = document.getElementById("durationSelect");
  const endDateDisplay = document.getElementById("endDateDisplay");
  const startDateSelect = document.getElementById("startDate");
  const startDateValue = startDateSelect.value;
  const weeks = parseInt(durationSelect.value, 10);
 
  
  if (startDateValue && weeks) {
    const endDate = calculateEndDate(startDateValue, weeks);
    endDateDisplay.textContent = `${endDate}`;
    
    
  } else {
    endDateDisplay.textContent = "";
    
  }
}

// Update end date when either field changes
durationSe.addEventListener("change", updateEndDate);
startDateSe.addEventListener("change", updateEndDate);


function populateFridayOptions() {
  const select = document.getElementById("startDate");
  select.innerHTML = ""; // Clear any old options
  
  
  const fridays = getNextFridays();

  const today = new Date();
  const todayStr = today.toDateString();

  fridays.forEach(date => {
    const formattedValue = date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric"
  });
    
    const labelDate = date.toLocaleDateString("en-US", {
      year: "numeric",
      month: "long",
      day: "numeric"
    });

    const option = document.createElement("option");
    option.value = formattedValue;

    // If this date is today, add label
    if (date.toDateString() === todayStr) {
      option.textContent = `${labelDate} (Today)`;
    } else {
      option.textContent = labelDate;
    }

    select.appendChild(option);
  });
}


populateFridayOptions();


window.addEventListener("DOMContentLoaded", () => {
  const urlParams = new URLSearchParams(window.location.search);
  const isFromLink = urlParams.has("id");
  const storedUserId = localStorage.getItem("optimumUserId");
  const storedThreeDay = localStorage.getItem("optimumThreeDayCars");
  const storedSixDay = localStorage.getItem("optimumSixDayCars");
  const storedStartDate = localStorage.getItem("optimumStartDate");

  if (storedUserId) document.getElementById("userId").value = storedUserId;
  if (storedThreeDay) document.getElementById("threeDayCars").value = storedThreeDay;
  if (storedSixDay) document.getElementById("sixDayCars").value = storedSixDay;

  // Wait for Fridays to populate, then select the stored one
  setTimeout(() => {
    if (storedStartDate) {
      const startDateSelect = document.getElementById("startDate");
      for (let option of startDateSelect.options) {
        if (option.value === storedStartDate) {
          startDateSelect.value = storedStartDate;
          break;
        }
      }
    }
  }, 300);
});

function getNextFridayDate() {
  const today = new Date();
  const date = new Date(today);
  const day = today.getDay();
  const daysUntilFriday = (5 - day + 7) % 7 || 7;
  date.setDate(date.getDate() + daysUntilFriday);
  return date.toISOString().split("T")[0];
}

function tryAutoRenewFromURL() {
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");
  const three = parseInt(params.get("three") || "0");
  const six = parseInt(params.get("six") || "0");
  const name = params.get("name");

  if (id && (three > 0 || six > 0)) {
    // Pre-fill the form
    document.getElementById("userId").value = id;
    document.getElementById("threeDayCars").value = three;
    document.getElementById("sixDayCars").value = six;

    // Set start date to next Friday
    //const friday = getNextFridayDate();
    //document.getElementById("startDate").value = friday;
     document.getElementById("rem").remove();
     document.getElementById("rem").remove();
     document.getElementById("rem").remove();
    document.getElementById("startDate").remove();
    document.getElementById("durationSelect").remove();
    document.getElementById("endDateDisplay").remove();
    document.getElementById("startDate").style.display = "block";
    document.getElementById("durationSelect").style.display = "block";
    document.getElementById("endDateDisplay").style.display = "block";
    populateFridayOptions();
    updateEndDate();
    document.getElementById("startDate").addEventListener("change", updateEndDate);
    document.getElementById("durationSelect").addEventListener("change", updateEndDate);


    // Store it
    localStorage.setItem("optimumUserId", id);
    localStorage.setItem("optimumThreeDayCars", three);
    localStorage.setItem("optimumSixDayCars", six);
    //localStorage.setItem("optimumStartDate", friday);

    // Simulate form submission to skip to summary
    const fakeEvent = new Event("submit", { bubbles: true });
    document.getElementById("renewal-form").dispatchEvent(fakeEvent);
  }
  // ✅ Show welcome message if name is present
    if (name) {
      setTimeout(() => showWelcomeMessage(name), 300); // Wait for summary to show
    }
    if(id){
    setTimeout(() => {
  document.getElementById("summary-note").style.display = "block";
  }, 300);
  }
}



// Run this after DOM and Fridays are ready
window.addEventListener("DOMContentLoaded", () => {
  const urlParams = new URLSearchParams(window.location.search);
  const isFromLink = urlParams.has("id");
  const storedUserId = localStorage.getItem("optimumUserId");
  const storedThreeDay = localStorage.getItem("optimumThreeDayCars");
  const storedSixDay = localStorage.getItem("optimumSixDayCars");
  const storedStartDate = localStorage.getItem("optimumStartDate");

  if (storedUserId) document.getElementById("userId").value = storedUserId;
  if (storedThreeDay) document.getElementById("threeDayCars").value = storedThreeDay;
  if (storedSixDay) document.getElementById("sixDayCars").value = storedSixDay;
  
  setTimeout(() => {
    if (storedStartDate) {
      const startDateSelect = document.getElementById("startDate");
      for (let option of startDateSelect.options) {
        if (option.value === storedStartDate) {
          startDateSelect.value = storedStartDate;
          break;
        }
      }
    }

    // ✅ Handle summary auto-renew
    tryAutoRenewFromURL();

    // ✅ Only show "start-note" if user did not come from a link
    if (!isFromLink) {
      document.getElementById("start-note").style.display = "block";
    }

  }, 400); // Give time for Friday options to populate
});


function showWelcomeMessage(name) {
  const summaryHeading = document.querySelector("#renewal-step-2 h2");

  const existingMessage = document.getElementById("welcome-msg");
  if (existingMessage) existingMessage.remove();
  function capitalizeFirstLetter(str) {
  if (str.length === 0) {
    return ""; // Handle empty strings
  }
  return str.charAt(0).toUpperCase() + str.slice(1);
}

const myString = name;
const capitalizedString = capitalizeFirstLetter(myString);

  const welcome = document.createElement("h3");
  welcome.id = "welcome-msg";
  welcome.style.color = "goldenrod";
  welcome.style.fontWeight = "bold";
  welcome.style.marginTop = "5px";
  welcome.textContent = `Welcome back, ${capitalizedString}!`;

  // Insert just after the <h2> tag
  summaryHeading.insertAdjacentElement("afterend", welcome);
}



</script>
</body>
</html>
