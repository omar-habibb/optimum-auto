<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Subscribe - Optimum Auto</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    *{
        margin:0;
    }

   body {
      font-family: 'Segoe UI', sans-serif;
      line-height: 1.6;
      background-image: linear-gradient(black 15%,goldenrod,black 80%);
      color: #333;
      margin: 0;
      padding: 0;
      width: 100%;
      overflow-x: hidden;

      
    }
    .container {
     
      max-width: 700px;
      margin: auto;
    
      padding: 30px;
      border-radius: 10px;
      
      margin-bottom: 10px;
      margin-top: 10px;

    }
    
    h2, h3 {
      text-align: center;
      margin-bottom: 20px;
    }
    #area{
      margin-left:10px;

    }
    
    input{
      width: 90%;
      padding: 10px;
      margin: 10px 10px;
      border: 3px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
      
    }
    label{
      margin-left:10px ;
    }
     select, textarea, button {
      width: 95%;
      padding: 10px;
      margin: 10px 10px;
      border: 3px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
    }
    .car-section {
      
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 15px;
    }
    .summary-car {
      background:#FBC901;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    .summary-car-fields {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .summary-car-field {
      flex: 1 1 calc(33% - 10px);
      min-width: 250px;
    }
    .summary-item {
      margin-bottom: 10px;
      max-width: max-content;
    }
    .btn {
      background: black;
      color: white;
      border: none;
      cursor: pointer;
    }
    .btn.back {
      background: #ccc;
      color: black;
    }
    .hidden {
      display: none;
    }

    .step.summary,
#step1,
#step2,
#step3,
#step4,
#step5 {
  background-color: #f5f5f5;
  border: 1px solid #ddd;
  padding: 15px;
  border-radius: 8px;
}
    .summary-item strong {
  color: #333;
}
#policyBox{
  position: fixed;
  top: 25%;
  bottom: 20%;
  right: 20px;
  left: 20px;
  background-color: white ;
  color: #000;
  font-size: 1rem;
  border: 5px solid black;
  border-radius: 10px;
  text-align: left;
  height: fit-content;
  max-height: 400px;
  width:auto;
  overflow: auto;
  overflow-y: scroll;
  padding:10px;
}
#policyCheckbox{
  width:min-content;
  color:gold;
  background-color:gold;
  
}
#sbtn{
  text-align: center;
  text-decoration: none;
  color: black;
  position: sticky;
  top:100;
  bottom: 0;
  float: right;
  left:0px;
  background-color: gold;
  padding: 7px;
  width:70px ;
  border: none;
  border-radius: 5px;
  font-weight: 700;
}
#step5 h3 {
  margin-top: 0;
}
#contcont{
 min-height: 600px;
}
/* Navbar */
.containernav {
  width: 100%;
  max-width: 1100px;
  margin: 0 auto;
  padding:10px 0rem;
  
}
.containernav a{
    text-decoration: none;
    
}
#opnav{
    margin-left:30px;
}

.navbar {
  background-color: black;
 
  box-shadow: 0 1px 4px rgba0,0,0,0.1;
  position: sticky;
  top: 0px;
  z-index: 1000;
}

.nav-links {
  list-style: none;
  display: flex;
  gap: 1rem;
  position: relative;
  padding: 0;
}
.nav-links li a {
  color: lightgrey;
  text-decoration: none;
  transition: color 0.3s;
}
.nav-links li a:hover {
  color: #eab308;
}
.text-xl {
    color: goldenrod;
    font-size: 35px;
}
.logo-combo {
  display: flex;
  align-items: center;
  gap: 10px; /* space between logo and text */
  text-decoration: none;
  margin-bottom: 4px;
  
}

.logo-img {
  height: 40px;      /* increase height */
  width: auto;       /* maintain aspect ratio */
  object-fit: contain;
}


.logo-text {
  font-size: 1.7rem;
  font-weight: bold;
  color: goldenrod /* golden yellow or change to match your theme */
}


/* footer */
footer {
  background-color: #000;
  color: #fff;
  padding: 2rem 1rem;
  text-align: center;
}
.footer-policy-btn {
  display: inline-block;
  background-color: black; /* Goldenrod */
  color:whitesmoke;
  font-weight: bold;
  width:auto;
  margin: 0.4rem;
  font-size: 0.9rem;
  transition: background-color 0.3s ease;
  border: none;
  cursor: pointer;
}

.footer-policy-btn:hover {
  color: #ca8a04; /* Darker goldenrod */
}
.hidden {
  display: none;
}

.policy-content{
  position: fixed;
  top: 25%;
  bottom: 20%;
  right: 20px;
  left: 20px;
  background-color: white ;
  color: #000;
  font-size: 1rem;
  border: 5px solid black;
  border-radius: 10px;
  text-align: left;
  height: fit-content;
  max-height: 400px;
  width:auto;
  overflow: auto;
  overflow-y: scroll;
  padding:10px;
}
.policy-content p , li{
  margin-left: 7px;
}
#fc-btn{
  position: sticky;
  top:100;
  bottom: 0;
  float: right;
  left:0px;
  background-color: gold;
  padding: 7px;
  width:70px ;
  border: none;
  border-radius: 5px;
  font-weight: 700;
}

  </style>
</head>
<body>

<!-- Sticky Navigation -->
  <nav class="navbar">
    <div class="containernav">
      <a href="index.html" class="logo-combo">
  <img src="logo.png" alt="Optimum Auto Logo" class="logo-img" />
  <span class="logo-text">Optimum Auto</span>
</a>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="service.html">Service</a></li>
        <li><a href="membership.html">Membership</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </div>
</nav>

<div id="contcont">
<div class="container">
 

  <!-- Subscription Form -->
  <form id="subscriptionForm">
  
    <!-- Step 1: Customer Info -->
    <div id="step1" class="step active">
      <h2 style="color:goldenrod;">Optimum Auto<br> Membership Form</h2>
      <h3>Customer Information</h3>
      <label for="firstName">First Name:</label>
      <input type="text" name="firstName" placeholder="First Name" required />
      <label for="lastName">Last Name:</label>
      <input type="text" name="lastName" placeholder="Last Name" required />
      <label for="phone">Phone Number (WhatsApp):</label>
      <input type="tel" name="phone" placeholder="Phone Number (WhatsApp)" required />
      <label for="area">Select Area:</label>
      <select name="area" id="area" required>
     <option value="">Select Area</option>
  <option value="Oriana 1">Oriana 1</option>
  <option value="Oriana 2">Oriana 2</option>
  <option value="Oriana 3">Oriana 3</option>
  <option value="Oriana 4">Oriana 4</option>
</select>
      <label for="buildingNumber">Building number:</label>
      <input type="text" name="buildingNumber" placeholder="Building Number" required />
      <label for="number">Total Number of Cars:</label>
      <input type="number" name="totalCars" min="1"  placeholder="Number of Cars" id="totalCarsInput" required />
      <button type="button" class="btn">Next</button>
    </div>

    <!-- Step 2: Car Details -->
    <div id="step2" class="step hidden">
      <h2 style="color:goldenrod;">Optimum Auto<br> Membership Form</h2>
      <h3>Car Details</h3>
      <div id="carDetailsContainer"></div>
      <button type="button" class="btn back">Back</button>
      <button type="button" class="btn">Next</button>
    </div>

    <!-- Step 3: start date -->
    <div id="step3" class="step hidden">
      <h2 style="color:goldenrod;">Optimum Auto<br> Membership Form</h2>
      <h3>Select Start Date</h3>
      <p>Please choose a Friday.</p>
      <select name="startDate" required>
        <option value="">Select a Friday</option>
      </select>
      <button type="button" class="btn back">Back</button>
      <button type="button" class="btn">Next</button>
    </div>
    

    <!-- Step 4: summary -->
    
    <div id="step4" class="step hidden">
      <h2 style="color:goldenrod;">Optimum Auto<br> Membership Form</h2>
      <h3>Summary</h3>
      <div id="summaryContainer"></div>

<!-- Policies Section -->
<div style="margin-top: 20px;">
  
  <label style="display: block; margin-bottom: 10px;">
    <input type="checkbox" id="policyCheckbox" required />
    <strong>I have read and agree to the <a href="#" onclick="togglePolicy(event)">Policies & What to Do</a></strong>
  </label>
  

  <!-- Hidden Policy Box -->
  <div id="policyBox" style="background:#fefce8; padding:15px; border-left:4px solid #eab308; display:none;">
    <h4>üöò Optimum Auto ‚Äì Service Terms & What You Should Know</h4>
    <p>To keep your experience smooth and your car looking its best, here are a few simple things to know before each wash. Nothing complicated ‚Äî just easy steps to help us deliver the best results.</p>

    <h4>‚úÖ What You Should Do</h4>
    <ul>
      <li>Please make sure all windows, sunroof, trunk, and hood are closed.</li>
      <li>Park your car within one building to the left or right of your registered address.</li>
      <li>If your car‚Äôs color or license plate has changed, just let us know on WhatsApp.</li>
      <li>Our team will wash your car at any time within the time your car will be available from and the time it needs to be done by. 
      If the car will arrive later or needs to be used earlier than that time frame, please notify us before 10:00 PM on the same day via WhatsApp.</li>
    </ul>

    <h4>‚ö†Ô∏è When We Can‚Äôt Wash the Car</h4>
    <ul>
      <li>Open windows, sunroof, trunk, or hood at the time of service.</li>
      <li>Car is parked outside the allowed area (not within one building of your location).</li>
      <li>License plate or color changed without prior notice.</li>
      <li>Car is in a garage with direct building access.</li>
      <li>Car is not present during the time range provided, and we were not informed before 10:00 PM.</li>
      <li>Rainy weather that prevents safe washing.</li>
    </ul>

    <h4>üì± Communication</h4>
    <p>All service-related updates, changes, or notifications will be sent through WhatsApp. Please make sure your number is active and reachable.</p>
    <a id="sbtn" href="#" onclick="togglePolicy(event)">Accept</a>
  </div>
</div>

<button type="button" class="btn back">Back</button>
<button type="button" class="btn" id="nextBtn">Next</button>
    </div>
    

    <!-- Step 5: Confirmation -->
    <div id="step5" class="step hidden text-center">
      <h2>LOADING PAYMENT GATEWAY....</h2>
    </div>

  </form>
</div>
</div>
</div>

<!-- Footer -->
  <footer class="bg-black text-white py-8">
    <div class="containerft text-center">
      <p>&copy; <span id="year"></span> Optimum Auto. All rights reserved.</p>
    </div>

<p>
    <i class="fa-solid fa-location-dot" style="color:gold;"></i>
    Cairo, Egypt</p>

    <!-- Policy Toggle Buttons -->
    <div class="policy-buttons flex flex-wrap justify-center gap-3 mb-4">
      <button type="button" class="footer-policy-btn">Privacy Policy</button>
      <button type="button" class="footer-policy-btn">Refund & Exchange</button>
      <button type="button" class="footer-policy-btn">Terms & Conditions</button>
    </div>

    <!-- Policy Content Sections -->
     <!--privacy-->
<div class="policy-container">
  <div class="policy-item">
    <div class="policy-content hidden">
      
      <h3>Privacy Policy</h3>
      <p>
        At Optimum Auto, your privacy is important to us. This Privacy Policy outlines how we collect, use, and protect your personal information when you use our services.
      </p>
      <h4>Information We Collect</h4>
      <p>
        We collect only the information necessary to deliver our services effectively and securely:
      </p>
      <ul>
        <li>-Full Name</li>
        <li>-Phone Number</li>
        <li>-Address</li>
        <li>-Car Details</li>
        <li>-Number of Cars</li>
      </ul>
      <h4>How We Use Your Information</h4>
      <p>
        Your data is used strictly for operational purposes:
      </p>
      <ul>
        <li>-To manage your car wash subscription</li>
        <li>-To schedule and deliver service to your specified location</li>
        <li>-To send service-related notifications (e.g., reminders or updates) via WhatsApp</li>
        <li>-To process payments securely through our payment provider (see below)</li>
      </ul>
      <p>
        We do not send promotional content and we do not share your information with any third parties.
      </p>
      <h4>Payment Processing</h4>
      <P>
        When you complete a payment through our platform, a limited set of billing data is securely shared with our payment provider, Paymob, for transaction processing purposes. This includes:
      </P>
      <ul>
        <li>-First Name</li>
        <li>-Last Name</li>
        <li>-Phone Number</li>
        <li>-BUilding Number</li>
      </ul>
      <p>
        This data is used solely to identify the payment and ensure proper service delivery. It is not used for marketing or any other purposes.
      </p>
      <h4>Data Storage & Security</h4>
      <p>
        All user data is stored in protected files and handled with confidentiality. We do not use cookies or third-party trackers. Some data may be stored in your browser‚Äôs local storage for smoother interaction on our website ‚Äî none of this is shared externally.
      </p>
      <h4>Your Rights</h4>
      <p>You have full control over your data:</p>
      <ul>
        <li>-You may request to update or correct your information at any time.</li>
        <li>-You may request to delete your data from our system.</li>
      </ul>
      <p>To do so, simply contact us via WhatsApp or email.</p>
      <h4>Policy Updates</h4>
      <p>We may update this Privacy Policy if needed to reflect changes in service. We will notify you of any major updates.</p>
      <br>
      <h5>If you have any questions or concerns regarding your privacy, feel free to reach out to us via the methods listed on our  <a href="contact.html" style="color: goldenrod;">Contact Page.</a></h5>
      <button id="fc-btn" onclick="cl()">Accept</button>
    </div>
  </div>

  <div class="policy-item">
    <div class="policy-content hidden">
      <h3>Refund & Exchange Policy</h3>
      <P>
        At Optimum Auto, we aim to provide a seamless and reliable service. To ensure transparency and fairness. Please review the following terms regarding refunds and subscription changes:
      </P>
      <h4>Refunds</h4>
      <p>
        <strong>Payment Errors:</strong> If a customer is charged incorrectly due to a system or billing error, a full refund will be issued upon verification.
      </p>
      <p>
        <strong>Cancellation Within First 2 Weeks:</strong> If a customer chooses to cancel their subscription within 14 days from the start date, they are eligible for a refund of 50% of the total amount paid.
      </p>
      <p>
        <strong>Cancellation After 2 Weeks:</strong> Requests for cancellation made after the initial two-week period from the start date are not eligible for a refund.
      </p>
      <h4>Plan Changes</h4>
      <p>
        <strong>Upgrading from 3-Day to 6-Day Plan:</strong>
        <br>-Customers may upgrade their plan within 7 days of the subscription start date, with the price difference applied accordingly.
        <br>-After this period, upgrades can still be made, but we recommend scheduling them for the upcoming month, as it would be more cost-effective for the customer.
        <br>-The upgraded plan will be applied starting from the following week to ensure proper planning and availability.
      </p>
      <p>
        <strong>Downgrading from 6-Day to 3-Day Plan:</strong>
        <br>-Downgrades can be requested within the first 3 days of the subscription start date for a refund of the price difference.
        <br>-After that, customers may still downgrade at any time, but no refund will be issued. It is recommended to apply such changes for the upcoming month.
        <br>-The change to the downgraded plan will be processed and applied instantly after confirmation.
      </p>
      <h4>Missed Washes</h4>
      <p>
        We strive to maintain reliable service and consistent scheduling. In the rare case that a wash cannot be completed due to unexpected or uncontrollable circumstances (such as weather or logistical challenges), we will notify the customer in advance via WhatsApp, and do our best to minimize any disruption to the service. Our team always aims to operate with professionalism and transparency.
      </p>
      <br>
      <h5>For any refund or exchange inquiries, feel free to reach out to us via the methods listed on our <a href="contact.html" style="color: goldenrod;">Contact Page.</a></h5>
      <button id="fc-btn" onclick="cl()">Accept</button>
    </div>
  </div>


  <div class="policy-item">
    <div class="policy-content hidden">

      <h4>üöò Optimum Auto ‚Äì Service Terms & What You Should Know</h4>
    <p>To keep your experience smooth and your car looking its best, here are a few simple things to know before each wash. Nothing complicated ‚Äî just easy steps to help us deliver the best results.</p>

    <h4>‚úÖ What You Should Do</h4>
    <ul>
      <li>-Please make sure all windows, sunroof, trunk, and hood are closed.</li>
      <li>-Park your car within one building to the left or right of your registered address.</li>
      <li>-If your car‚Äôs color or license plate has changed, just let us know on WhatsApp.</li>
      <li>-Our team will wash your car at any time within the time your car will be available from and the time it needs to be done by. 
      If the car will arrive later or needs to be used earlier than that time frame, please notify us before 10:00 PM on the same day via WhatsApp.</li>
    </ul>

    <h4>‚ö†Ô∏è When We Can‚Äôt Wash the Car</h4>
    <ul>
      <li>-Open windows, sunroof, trunk, or hood at the time of service.</li>
      <li>-Car is parked outside the allowed area (not within one building of your location).</li>
      <li>-License plate or color changed without prior notice.</li>
      <li>-Car is in a garage with direct building access.</li>
      <li>-Car is not present during the time range provided, and we were not informed before 10:00 PM.</li>
      <li>-Rainy weather that prevents safe washing.</li>
    </ul>

    <h4>üì± Communication</h4>
    <p>All service-related updates, changes, or notifications will be sent through WhatsApp. Please make sure your number is active and reachable.</p>
    <br>
    <h5>For any questions, issues, or feedback,  feel free to reach out to us via the methods listed on our <a href="contact.html" style="color: goldenrod;">Contact Page.</a></h5>
    <button id="fc-btn" onclick="cl()">Accept</button>
    </div>
  </div>
</div>

</footer>

<script>
    //accept policy
function cl(){
  const policies = document.querySelectorAll(".policy-content");
  policies.forEach(policy => {
    policy.classList.add("hidden");
    });

}
//policies
document.querySelectorAll(".footer-policy-btn").forEach((btn, index) => {
  btn.addEventListener("click", () => {
    const policies = document.querySelectorAll(".policy-content");
    
    // Hide all policy sections first
    policies.forEach(policy => {
      policy.classList.add("hidden");
    });

    // Show the one that matches the clicked button
    if (policies[index]) {
      policies[index].classList.remove("hidden");
    }
  });
});
//year
document.getElementById("year").textContent = new Date().getFullYear();
  const steps = document.querySelectorAll(".step");
  let currentStep = 0;
  const formData = JSON.parse(localStorage.getItem("optimumAuto")) || {};

  // Populate form from localStorage
  Object.keys(formData).forEach(key => {
    const el = document.querySelector(`[name='${key}']`);
    if (el) el.value = formData[key];
  });

  const select = document.querySelector("select[name='startDate']");
  generateFridays(select);

  function generateFridays(selectElement) {
    const today = new Date();
    let currentDate = new Date(today);
    const currentDay = today.getDay();
    let daysToAdd = (5 - currentDay + 7) % 7 || 7;
    currentDate.setDate(today.getDate() + daysToAdd);

    for (let i = 0; i < 52; i++) {
      const option = document.createElement("option");
      option.value = currentDate.toISOString().split("T")[0];
      option.textContent = currentDate.toLocaleDateString("en-US", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric"
      });
      selectElement.appendChild(option);
      currentDate.setDate(currentDate.getDate() + 7);
    }

    if (formData.startDate) selectElement.value = formData.startDate;
  }

  document.querySelectorAll(".btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const direction = btn.textContent === "Next" ? 1 : -1;

    if (direction === 1) {
  if (currentStep === 3) { // Summary step
    const checkbox = document.getElementById("policyCheckbox");
    if (!checkbox?.checked) {
      alert("You must agree to the policies before continuing.");
      return;
    }
  }

  if (!validateStep(currentStep)) return;
}

    // Hide current step
    steps[currentStep].classList.add("hidden");

    // Update currentStep safely
    if (direction === 1 && currentStep < steps.length - 1) {
      currentStep++;
    } else if (direction === -1 && currentStep > 0) {
      currentStep--;
    }

    // Show new step
    steps[currentStep].classList.remove("hidden");

    // Run step-specific functions
    if (currentStep === 1) generateCarFields(); // Car Details
    if (currentStep === 2) generateFridays(select); // Start Date
    if (currentStep === 3) {
      const cars = collectCars();
      generateSummary(cars); // Summary
    }
    if (currentStep === 4) {
      saveData(); // Save + Send Data
      const submission = buildSubmissionObject();
      sendDataToGoogleSheet(submission);
      shitstart();
    }
    
  });
});

  function validateStep(stepIndex) {
    const step = steps[stepIndex];
    const inputs = step.querySelectorAll("input, select");
    for (const input of inputs) {
      if (!input.checkValidity()) {
        input.reportValidity();
        return false;
      }
    }
    return true;
  }

  function togglePolicy(e) {
  e.preventDefault();
  const policyBox = document.getElementById("policyBox");
  policyBox.style.display = policyBox.style.display === "none" ? "block" : "none";
}

  function generateCarFields() {
    const container = document.getElementById("carDetailsContainer");
    const totalCars = Math.min(parseInt(document.querySelector("[name='totalCars']").value) || 1, 15);

    // Save existing values before clearing
    const savedCars = [];
    for (let i = 0; i < totalCars; i++) {
      const brand = container.querySelector(`[name='car[${i}][brand]']`)?.value || "";
      const model = container.querySelector(`[name='car[${i}][model]']`)?.value || "";
      const color = container.querySelector(`[name='car[${i}][color]']`)?.value || "";
      const plate = container.querySelector(`[name='car[${i}][plate]']`)?.value || "";
      const plan = container.querySelector(`[name='car[${i}][plan]']`)?.value || "";
      const availableFrom = container.querySelector(`[name='car[${i}][availableFrom]']`)?.value || "";
      const doneBy = container.querySelector(`[name='car[${i}][doneBy]']`)?.value || "";
      const notes = container.querySelector(`[name='car[${i}][notes]']`)?.value || "";

      savedCars.push({ brand, model, color, plate, plan, availableFrom, doneBy, notes });
    }

    container.innerHTML = "";

    for (let i = 0; i < totalCars; i++) {
      const div = document.createElement("div");
      div.className = "car-section";
      div.innerHTML = `
        <h4>Car ${i+1}</h4>
        <input type="text" name="car[${i}][brand]" placeholder="Brand" value="${savedCars[i]?.brand || ''}" required />
        <input type="text" name="car[${i}][model]" placeholder="Model" value="${savedCars[i]?.model || ''}" required />
        <input type="text" name="car[${i}][color]" placeholder="Color" value="${savedCars[i]?.color || ''}" required />
        <input type="text" name="car[${i}][plate]" placeholder="Plate Number" value="${savedCars[i]?.plate || ''}" required />

        <label>
          Wash Plan:
          <select name="car[${i}][plan]" required>
            <option value="">Select Plan</option>
            <option value="6" ${savedCars[i]?.plan === "6" ? "selected" : ""}>6 Days/Week</option>
            <option value="3" ${savedCars[i]?.plan === "3" ? "selected" : ""}>3 Days/Week</option>
          </select>
        </label>

        <label>
  Available From:
  <select name="car[${i}][availableFrom]" id="availableFrom-${i}">
    ${Array.from({ length: 5 }, (_, i) => i + 1).map(h => `<option value="${h}:00 AM">${h}:00 AM</option>`).join("")}
  </select>
</label>

<label>Need Done By:
  <select name="car[${i}][doneBy]" id="doneBy-${i}">
    <option value="">Select done by</option>
    ${Array.from({ length: 7 }, (_, i) => i + 2).map(h => 
      h === 8 ? 
        `<option selected value="${h}:30 AM">${h}:30 AM</option>` : 
        `<option value="${h}:30 AM">${h}:30 AM</option>`
    ).join("")}
  </select>
</label>

        <textarea name="car[${i}][notes]" placeholder="Notes about this car (optional)">${savedCars[i]?.notes || ''}</textarea>
      `;
      container.appendChild(div);
      setupTimeValidation(i);
    }

    // Restore time selections
    for (let i = 0; i < totalCars; i++) {
      const availableFromInput = container.querySelector(`[name='car[${i}][availableFrom]']`);
      if (availableFromInput && savedCars[i]?.availableFrom) availableFromInput.value = savedCars[i].availableFrom;

      const doneByInput = container.querySelector(`[name='car[${i}][doneBy]']`);
      if (doneByInput && savedCars[i]?.doneBy) doneByInput.value = savedCars[i].doneBy;
    }
  }

  function collectCars() {
    const container = document.getElementById("carDetailsContainer");
    const totalCars = Math.min(parseInt(document.querySelector("[name='totalCars']").value) || 1, 15);
    const cars = [];

    for (let i = 0; i < totalCars; i++) {
      const brand = container.querySelector(`[name='car[${i}][brand]']`)?.value || "";
      const model = container.querySelector(`[name='car[${i}][model]']`)?.value || "";
      const color = container.querySelector(`[name='car[${i}][color]']`)?.value || "";
      const plate = container.querySelector(`[name='car[${i}][plate]']`)?.value || "";
      const plan = container.querySelector(`[name='car[${i}][plan]']`)?.value || "";
      const availableFrom = container.querySelector(`[name='car[${i}][availableFrom]']`)?.value || "";
      const doneBy = container.querySelector(`[name='car[${i}][doneBy]']`)?.value || "";
      const notes = container.querySelector(`[name='car[${i}][notes]']`)?.value || "";

      if (brand || model || color || plate || plan) {
        cars.push({
          brand,
          model,
          color,
          plate,
          plan,
          availableFrom,
          doneBy,
          notes
        });
      }
    }

    return cars;
  }

  function calculatePrice(cars = []) {
    let totalPrice = 0;
    let originalPrice = 0;

    const sixDayCars = cars.filter(c => c.plan === "6");
    const threeDayCars = cars.filter(c => c.plan === "3");

    if(sixDayCars.length === 1 && threeDayCars.length === 1 ){
      totalPrice += 1150;
      originalPrice += 1250;
    } else if(sixDayCars.length === 2 && threeDayCars.length === 1){
      totalPrice += 1900;
      originalPrice += 2050;
    }else if(sixDayCars.length === 1 && threeDayCars.length === 2){
      totalPrice += 1550;
      originalPrice += 1700;
    }else if(sixDayCars.length >= 3  && threeDayCars.length === 1){
      totalPrice += ( 700 * sixDayCars.length)+400;
      originalPrice +=  (800 * sixDayCars.length)+450;
    }else if(sixDayCars.length === 1  && threeDayCars.length >= 3){
      totalPrice += 750+(350 * threeDayCars.length);
      originalPrice +=  800+(450 * threeDayCars.length);
    }else if(sixDayCars.length >= 3  && threeDayCars.length === 2){
      totalPrice += ( 700 * sixDayCars.length)+750;
      originalPrice +=  (800 * sixDayCars.length)+900;
    }else if(sixDayCars.length === 2  && threeDayCars.length >= 3){
      totalPrice += 1450+(350 * threeDayCars.length);
      originalPrice +=  1600+(450 * threeDayCars.length);
    }else if(sixDayCars.length === 2 && threeDayCars.length === 2){
      totalPrice += 2200;
      originalPrice += 2500;
    }else{
    if (sixDayCars.length === 1) {
      totalPrice += 800;
      originalPrice += 800;
    } else if (sixDayCars.length === 2) {
      totalPrice += 750 * 2;
      originalPrice += 800 * 2;
    } else if (sixDayCars.length >= 3) {
      totalPrice += 700 * sixDayCars.length;
      originalPrice += 800 * sixDayCars.length;
    }

    if (threeDayCars.length === 1) {
      totalPrice += 450;
      originalPrice += 450;
    } else if (threeDayCars.length === 2) {
      totalPrice += 400 * 2;
      originalPrice += 450 * 2;
    } else if (threeDayCars.length >= 3) {
      totalPrice += 350 * threeDayCars.length;
      originalPrice += 450 * threeDayCars.length;
    }
    }

    return {
      totalPrice: parseFloat(totalPrice.toFixed(2)),
      originalPrice: parseFloat(originalPrice.toFixed(2))
    };
  }

  function generateSummary(cars) {
  const container = document.getElementById("summaryContainer");
  container.innerHTML = "<h4>Your Selection</h4>";

  // Show customer info
  const fields = ["firstName", "lastName", "phone", "area", "buildingNumber", "totalCars"];
  fields.forEach(name => {
    const val = document.querySelector(`[name='${name}']`)?.value || "";
    if (val) {
      container.innerHTML += `<div class="summary-item"><strong>${toTitleCase(name)}:</strong> ${val}</div>`;
    }
  });
    //show start date
    const startDate = document.querySelector("[name='startDate']")?.value || "";
if (startDate) {
  container.innerHTML += `<div class="summary-item"><strong>Start Date:</strong> ${startDate}</div>`;
}

  // Show car details
  cars.forEach((car, idx) => {
    let carHTML = `<div class="summary-car">`; // wrapper for car section
carHTML += `<h4>Car ${idx + 1}</h4>`;       // heading

carHTML += `<div class="summary-car-fields">`; // wrapper for fields
for (const key in car) {
  if (car[key]) {
    carHTML += `<div class="summary-item"><strong>${toTitleCase(key)}:</strong> ${car[key]}</div>`;
  }
}
carHTML += `</div></div>`; // close both .summary-car-fields and .summary-car

// Append to container
container.innerHTML += carHTML;


    
  });

  // Calculate price
  const { totalPrice, originalPrice } = calculatePrice(cars);
  const saved = (originalPrice - totalPrice).toFixed(2);

  

  // Generate suggestions based on car data
  const threeDayIndices = [];
  const sixDayIndices = [];

  cars.forEach((car, index) => {
    if (car.plan === "3") threeDayIndices.push(index + 1); // Car numbers start at 1
    else if (car.plan === "6") sixDayIndices.push(index + 1);
  });

  const totalCars = cars.length;
  let suggestion = "";

  if (threeDayIndices.length > 0 && sixDayIndices.length > 0) {
    const carsToSuggest = threeDayIndices.join(", ");
    suggestion = `
      <div style="background:#fefce8; padding:15px; border-left: 4px solid #eab308; margin-top:15px;">
        <strong>üí° Suggestion:</strong> You could save more by switching Car(${carsToSuggest}) to 6 Days/Week.
      </div>
    `;
  }

  if (totalCars === 2 && threeDayIndices.length >= 1) {
    const carsToSuggest = threeDayIndices.join(", ");
    suggestion = `
      <div style="background:#fefce8; padding:15px; border-left: 4px solid #eab308; margin-top:15px;">
        <strong>üí° Tip:</strong> Switch Car(${carsToSuggest}) to 6 Days/Week ‚Äî you‚Äôll get a better rate!
      </div>
    `;
  }

  if (totalCars === 3 && threeDayIndices.length === 1) {
    const carsToSuggest = threeDayIndices.join(", ");
    suggestion = `
      <div style="background:#fefce8; padding:15px; border-left: 4px solid #eab308; margin-top:15px;">
        <strong>üí° Tip:</strong> Try switching Car(${carsToSuggest}) to 6 Days/Week ‚Äî it may cost less per car.
      </div>
    `;
  }

  if (totalCars === 3 && threeDayIndices.length === 2) {
    const carsToSuggest = threeDayIndices.join(", ");
    suggestion = `
      <div style="background:#fefce8; padding:15px; border-left: 4px solid #eab308; margin-top:15px;">
        <strong>üí° Tip:</strong> Consider switching Car(${carsToSuggest}) to 6 Days/Week ‚Äî it could be cheaper overall.
      </div>
    `;
  }

  if (totalCars >= 4 && threeDayIndices.length >= 1) {
    const carsToSuggest = threeDayIndices.join(", ");
    const savingsEstimate = threeDayIndices.length * (450 - 700) + (threeDayIndices.length * 50); // rough estimate
    suggestion = `
      <div style="background:#fefce8; padding:15px; border-left: 4px solid #eab308; margin-top:15px;">
        <strong>üí° Pro Tip:</strong> You can save up to EGP ${Math.abs(savingsEstimate)} by switching Car(${carsToSuggest}) to 6 Days/Week.
      </div>
    `;
  }

  // Add suggestion if any
  if (suggestion) {
    container.innerHTML += suggestion;
  }

  // Final price display
  container.innerHTML += `
    <hr>
    <div class="summary-item"><strong>Original Price:</strong> EGP ${originalPrice.toFixed(2)}</div>
    <div class="summary-item"><strong>Offer Price:</strong> EGP ${totalPrice.toFixed(2)}</div>
    <div class="summary-item"><strong>You Save:</strong> EGP ${saved}</div>
  `;
    document.getElementById("policyCheckbox").addEventListener("change", () => {
  document.getElementById("nextBtn").disabled = !document.getElementById("policyCheckbox").checked;
});
}

  function buildSubmissionObject() {
  const customerInfo = {
    firstName: document.querySelector("[name='firstName']")?.value || "",
    lastName: document.querySelector("[name='lastName']")?.value || "",
    phone: document.querySelector("[name='phone']")?.value || "",
    area: document.querySelector("[name='area']")?.value || "",
    buildingNumber: document.querySelector("[name='buildingNumber']")?.value || "",
    totalCars: document.querySelector("[name='totalCars']")?.value || "",
    startDate: document.querySelector("[name='startDate']")?.value || ""
  };

  const cars = collectCars();

  // Flatten car data into submission object dynamically
  const submission = { ...customerInfo };
  cars.forEach((car, index) => {
    submission[`car${index}Brand`] = car.brand;
    submission[`car${index}Model`] = car.model;
    submission[`car${index}Color`] = car.color;
    submission[`car${index}Plate`] = car.plate;
    submission[`car${index}Plan`] = car.plan;
    submission[`car${index}AvailableFrom`] = car.availableFrom;
    submission[`car${index}DoneBy`] = car.doneBy;
    submission[`car${index}Notes`] = car.notes;
  });

  submission.submittedAt = new Date().toLocaleString();
  return submission;
}
  async function sendDataToGoogleSheet(data) {
    const url = "https://script.google.com/macros/s/AKfycbxgwnmD7U1_t-M_4ZoO2nXofBxf8f64NmUy3pJn8FbGCttS5Sf-6Ppzou43_GUKT7Fo/exec"; // Replace with real URL later

    try {
      const response = await fetch(url, {
        method: "POST",
        mode: "no-cors",
        body: JSON.stringify(data),
        headers: {
          "Content-Type": "application/json"
        }
      });

      console.log("Data sent:", data);
    } catch (error) {
      console.error("Error sending data:", error);
    }
  }

  function collectFormData() {
    const formData = {};
    const inputs = document.querySelectorAll("input, select, textarea");

    inputs.forEach(input => {
      if (input.name.includes("car[")) {
        const match = input.name.match(/car\$(\d+)\$\.(.+)/);
        if (match) {
          const index = match[1];
          const key = match[2];
          if (!formData.car) formData.car = [];
          if (!formData.car[index]) formData.car[index] = {};
          formData.car[index][key] = input.value;
        }
      } else {
        formData[input.name] = input.value;
      }
    });

    return formData;
  }

  function saveData() {
    const inputs = document.querySelectorAll("input, select, textarea");
    const data = {};

    inputs.forEach(input => {
      if (input.name.includes("car[")) {
        const match = input.name.match(/car\$(\d+)\$\.(.+)/);
        if (match) {
          const index = parseInt(match[1]);
          const key = match[2];
          if (!data.car) data.car = [];
          if (!data.car[index]) data.car[index] = {};
          data.car[index][key] = input.value;
        }
      } else {
        data[input.name] = input.value;
      }
    });

    localStorage.setItem("optimumAuto", JSON.stringify(data));
  }

  function restartForm() {
    localStorage.removeItem("optimumAuto");
    location.reload();
  }

  function toTitleCase(str) {
    return str.replace(/\w+/g, w => w[0].toUpperCase() + w.slice(1));
  }
  function setupTimeValidation(carIndex) {
    const availableFromSelect = document.querySelector(`#availableFrom-${carIndex}`);
    const doneBySelect = document.querySelector(`#doneBy-${carIndex}`);

    if (!availableFromSelect || !doneBySelect) return;

    // Helper to extract hour from time string like "1 Am"
    function getHour(timeStr) {
        // Handles "1 Am", "2 Am", etc.
        return parseInt(timeStr);
    }

    // Populate doneBy options based on availableFrom
    function populateDoneByOptions(availableHour) {
        doneBySelect.innerHTML = ""; // Clear existing options

        const minDoneByHour = availableHour + 3;
        let has830 = false;

        for (let h = minDoneByHour; h <= 8; h++) {
            const option = document.createElement("option");
            option.value = `${h}:30 AM`;
            option.textContent = `${h}:30 AM`;
            if (h === 8) {
                option.selected = true;
                has830 = true;
            }
            doneBySelect.appendChild(option);
        }

        // If no valid options
        if (minDoneByHour > 8) {
            const option = document.createElement("option");
            option.disabled = true;
            option.textContent = "No valid time";
            doneBySelect.innerHTML = "";
            doneBySelect.appendChild(option);
            doneBySelect.disabled = true;
        } else {
            doneBySelect.disabled = false;
            // If 8:30 AM is not in the options, select the last available option
            if (!has830 && doneBySelect.options.length > 0) {
                doneBySelect.options[doneBySelect.options.length - 1].selected = true;
            }
        }
    }

    // Initial population
    const initialAvailableHour = getHour(availableFromSelect.value);
    populateDoneByOptions(initialAvailableHour);

    // On change
    availableFromSelect.addEventListener("change", () => {
        const selectedHour = getHour(availableFromSelect.value);
        populateDoneByOptions(selectedHour);
    });
}


   function calcorder(){
    const cars = collectCars();
    const { totalPrice, originalPrice } = calculatePrice(cars);
    console.log(totalPrice);
    return totalPrice;

   }
   //async function oplink(){
     //var lnk = await shitstart();
     //window.location.href = lnk;
    //window.open(lnk);
   //}
    
   async function shitstart() {
  const totalEGP = calcorder(); // use your existing calcorder() function
  const amount_cents = totalEGP * 100;

  const billing_data = {
  first_name: document.querySelector("[name='firstName']").value,
  last_name: document.querySelector("[name='lastName']").value,
  phone_number: document.querySelector("[name='phone']").value,
  email: "omarr.habibb6@gmail.com",
  building: document.querySelector("[name='buildingNumber']").value,
  apartment: "NA",
  floor: "NA",
  street: "NA",
  shipping_method: "NA",
  postal_code: "NA",
  city: "Cairo",
  country: "EG",
  state: "Cairo"
};

  try {
    const response = await fetch('https://paymob-backend-production.up.railway.app/start-payment', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ amount_cents, billing_data })
    });

    const result = await response.json();

    if (result.iframe_url) {
      window.location.href = result.iframe_url;
    } else {
      alert("Payment failed: No iframe URL received.");
    }
  } catch (error) {
    console.error("Error starting payment:", error);
    alert("Something went wrong. Please try again.");
  }
}





</script>
</body>
</html>
