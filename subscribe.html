<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <title>Subscribe - Optimum Auto</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    *{
        margin:0;
    }

   body {
      font-family: 'Segoe UI', sans-serif;
      line-height: 1.6;
      background-image: linear-gradient(black 15%,goldenrod,black 80%);
      color: #333;
      margin: 0;
      padding: 0;
      width: 100%;
      overflow-x: hidden;

      
    }
    
    .container {
     
      max-width: 700px;
      margin: auto;
    
      padding: 30px;
      padding-left: 20px;
      padding: 20px;
      border-radius: 10px;
      
      margin-bottom: 10px;
      margin-top: 10px;

    }
    
    h2, h3 {
      text-align: center;
      margin-bottom: 20px;
    }
    #area{
      margin-left:10px;

    }
    
    input{
      width: 90%;
      padding: 10px;
      margin: 10px 10px;
      border: 3px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
      
    }
    label{
      margin-left:10px ;
    }

     #endDateDisplay {
      font-weight: 500;
      padding: 10px;
      margin: 10px 10px;
      border: 3px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
      color:rgb(10, 10, 10);
      
    }
    
     select, textarea, button{
      width: 95%;
      padding: 10px;
      margin: 10px 10px;
      border: 3px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
    }
    .car-section {
      
      padding: 15px;
      padding-left: 0px;
      border-radius: 5px;
      padding-bottom: 0px;

    }
    .summary-car {
      background:#FBC901;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    .summary-car-fields {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .summary-car-field {
      flex: 1 1 calc(33% - 10px);
      min-width: 250px;
    }
    .summary-item {
      margin-bottom: 10px;
      max-width: max-content;
    }
    .btn {
      background: gold;
      color: black;
      border: none;
      cursor: pointer;
      font-size: 1.1rem;
    }
    .btn.back {
      background: black;
      color: white;
    }
    .hidden {
      display: none;
    }

    .step.summary,
#step1,
#step2,
#step3,
#step4 {
  background-color: #f5f5f5;
  border: 1px solid #ddd;
  padding: 15px;
  border-radius: 8px;
  min-height: 300px;
}
#step5{
  background-color: #f5f5f5;
  border: 1px solid #ddd;
  padding: 15px;
  border-radius: 8px;
  min-height: 300px;
  font-weight: 900;
}
    .summary-item strong {
  color: #333;
}
#policyBox{
  position: fixed;
  top: 25%;
  bottom: 20%;
  right: 20px;
  left: 20px;
  background-color: white ;
  color: #000;
  font-size: 1rem;
  border: 5px solid black;
  border-radius: 10px;
  text-align: left;
  height: fit-content;
  max-height: 400px;
  width:auto;
  overflow: auto;
  overflow-y: scroll;
  padding:10px;
}
#policyCheckbox{
  width:min-content;
  color:gold;
  background-color:gold;
  
}
#sbtn{
  text-align: center;
  text-decoration: none;
  color: black;
  position: sticky;
  top:100;
  bottom: 0;
  float: right;
  left:0px;
  background-color: gold;
  padding: 7px;
  width:70px ;
  border: none;
  border-radius: 5px;
  font-weight: 700;
}
#step5 h3 {
  margin-top: 0;
}
#contcont{
 min-height: 600px;
}
/* Navbar */
.containernav {
  width: 100%;
  max-width: 1100px;
  margin: 0 auto;
  padding:10px 0rem;
  
}
.containernav a{
    text-decoration: none;
    
}
#opnav{
    margin-left:30px;
}

.navbar {
  background-color: black;
 
  box-shadow: 0 1px 4px rgba0,0,0,0.1;
  position: sticky;
  top: 0px;
  z-index: 1000;
}

.nav-links {
  list-style: none;
  display: flex;
  gap: 1rem;
  position: relative;
  padding: 0;
}
.nav-links li a {
  color: lightgrey;
  text-decoration: none;
  transition: color 0.3s;
}
.nav-links li a:hover {
  color: #eab308;
}
.text-xl {
    color: goldenrod;
    font-size: 35px;
}
.logo-combo {
  display: flex;
  align-items: center;
  gap: 10px; /* space between logo and text */
  text-decoration: none;
  margin-bottom: 4px;
  
}

.logo-img {
  height: 40px;      /* increase height */
  width: auto;       /* maintain aspect ratio */
  object-fit: contain;
}


.logo-text {
  font-size: 1.7rem;
  font-weight: bold;
  color: goldenrod /* golden yellow or change to match your theme */
}
/* Dropdown */
.dropdown {
  position: relative;
}

.dropdown-content {
  display: none;
  position: absolute;
  top: 100%;
  background-color: black;
  border: 1px solid #555;
  z-index: 1000;
  min-width: 140px;
  border-radius: 4px;
  list-style: none;
  padding: 0rem 0rem;
}

.dropdown-content li {
  padding: 0.5rem 1rem;
}

.dropdown-content li a {
  display: block;
  color: lightgrey;
  
}

.dropdown-content li a:hover {
  background-color: #333;
  color: #eab308;
}

.dropdown:hover .dropdown-content {
  display: block;
}


/* footer */
footer {
  background-color: #000;
  color: #fff;
  padding: 2rem 1rem;
  text-align: center;
}
.footer-policy-btn {
  display: inline-block;
  background-color: black; /* Goldenrod */
  color:whitesmoke;
  font-weight: bold;
  width:auto;
  margin: 0.4rem;
  font-size: 0.9rem;
  transition: background-color 0.3s ease;
  border: none;
  cursor: pointer;
}

.footer-policy-btn:hover {
  color: #ca8a04; /* Darker goldenrod */
}
.hidden {
  display: none;
}

.policy-content{
  position: fixed;
  top: 25%;
  bottom: 20%;
  right: 20px;
  left: 20px;
  background-color: white ;
  color: #000;
  font-size: 1rem;
  border: 5px solid black;
  border-radius: 10px;
  text-align: left;
  height: fit-content;
  max-height: 400px;
  width:auto;
  overflow: auto;
  overflow-y: scroll;
  padding:10px;
}
.policy-content p , li{
  margin-left: 7px;
}
#fc-btn{
  position: sticky;
  top:100;
  bottom: 0;
  float: right;
  left:0px;
  background-color: gold;
  padding: 7px;
  width:70px ;
  border: none;
  border-radius: 5px;
  font-weight: 700;
}
.strike {
    position: relative;
    display: inline-block; /* Or block, depending on your layout */
}

.strike::before {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    top: 48%; /* Adjust as needed for vertical centering */
    border-top:  0.1rem solid black; /* Or background-color */
    transform: rotate(0deg); /* Adjust the angle for tilt */
    transform-origin: center center; /* Ensure rotation around the center */
}
.note {
      font-size: 0.95rem;
      color: #666;
      margin-top: 8px;
    }
.note button{
  text-decoration: none;
  color: rgb(165, 119, 1);
  border: none;
  width:fit-content;
  padding:0px;
  margin:0px;
  font-size: 0.95rem;

}

  </style>
</head>
<body>

<!-- Sticky Navigation -->
  <nav class="navbar">
    <div class="containernav">
      <a href="index.html" class="logo-combo">
  <img src="logo.png" alt="Optimum Auto Logo" class="logo-img" />
  <span class="logo-text">Optimum Auto</span>
</a>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="service.html">Service</a></li>
        <li class="dropdown">
        <a href="#">Membership <i class="fa fa-caret-down"></i></a>
        <ul class="dropdown-content">
        <li><a href="subscribe.html">Subscribe</a></li>
        <li><a href="renewal.html">Renew</a></li>
        <li><a href="pricing.html">Pricing</a></li>
        </ul>
        </li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </div>
</nav>

<div id="contcont">
<div class="container">
 

  <!-- Subscription Form -->
  <form id="subscriptionForm">
  
    <!-- Step 1: Customer Info -->
    <div id="step1" class="step active">
      <h2 style="color:goldenrod;">Optimum Auto<br> Membership Form</h2>
      <h3>Customer Information</h3>
      <label for="firstName">First Name:</label>
      <input type="text" name="firstName" placeholder="First Name" required />
      <label for="lastName">Last Name:</label>
      <input type="text" name="lastName" placeholder="Last Name" required />
      <label for="phone">Phone Number (WhatsApp):</label>
      <input type="tel" name="phone" placeholder="Phone Number (WhatsApp)" required />
      <label for="email">Email:</label>
      <input type="email" name="email" placeholder="Email" required />
      <label for="area">Area:</label>
      <select name="area" id="area" required>
     <option value="">Select Area</option>
  <option value="Oriana 1">Oriana 1</option>
  <option value="Oriana 2">Oriana 2</option>
  <option value="Oriana 3">Oriana 3</option>
  <option value="Oriana 4">Oriana 4</option>
</select>
      <label for="buildingNumber">Building number:</label>
      <input type="text" name="buildingNumber" placeholder="Building Number" required />
      <label for="number">Total Number of Cars:</label>
      <input type="number" name="totalCars" min="1"  placeholder="Number of Cars" id="totalCarsInput" required />
      <button type="button" class="btn" id="nxtbtn">Next</button>
    </div>

    <!-- Step 2: start date -->
    <div id="step2" class="step hidden">
  <h2 style="color:goldenrod;">Optimum Auto<br> Membership Form</h2>
  <h3>Start Date & Duration</h3>
  <!-- Duration Selection -->
  <label for="durationSelect">Duration:</label>
  <select id="durationSelect" name="duration" required>
    <option value="">Select Duration</option>
    <option value="4">4 Weeks</option>
    
  </select>
  <!-- Start Date Selection -->
  <label for="startDateSelect">Start Date:</label>
  <select id="startDateSelect" name="startDate" required>
    <option value="">Select a Friday</option>
  </select>
  <!-- End Date Display -->
   <P style="margin-left:10px;">Renewal Date:</P>
  <p id="endDateDisplay" ></p>
  <button type="button" class="btn" id="nxtbtn">Next</button>
  <button type="button" class="btn back">Back</button>
</div>


    <!-- Step 3: Car Details -->
    <div id="step3" class="step hidden">
      <h2 style="color:goldenrod;">Optimum Auto<br> Membership Form</h2>
      <h3>Car Details</h3>
      <p class="note">Note: The plan name reflects how many days per week the car will be washed.</p>
      <div id="carDetailsContainer"></div>
      <p class="note" style="margin-bottom: 20px; margin-top: 0px;">*<button type="button" onclick="window.open('pricing.html?from=subscribe', '_blank')">View Pricing</button></p>
      <button type="button" class="btn" id="nxtbtn">Next</button>
      <button type="button" class="btn back">Back</button>
    </div>

   
    

    <!-- Step 4: summary -->
    
    <div id="step4" class="step hidden">
      <h2 style="color:goldenrod;">Optimum Auto<br> Membership Form</h2>
      <h3>Summary</h3>
      <div id="summaryContainer"></div>

<!-- Policies Section -->
<div style="margin-top: 20px;">
  
  <label style="display: block; margin-bottom: 10px;">
    <input type="checkbox" id="policyCheckbox" required />
    <strong>I have read and agree to the <a href="#" onclick="togglePolicy(event)">Policies & What to Do</a></strong>
  </label>
  

  <!-- Hidden Policy Box -->
  <div id="policyBox" style="background:#fefce8; padding:15px; border-left:4px solid #eab308; display:none;">
    <h4>🚘 Optimum Auto – Service Terms & What You Should Know</h4>
    <p>To keep your experience smooth and your car looking its best, here are a few simple things to know before each wash. Nothing complicated — just easy steps to help us deliver the best results.</p>

    <h4>✅ What You Should Do</h4>
    <ul>
      <li>Please make sure all windows, sunroof, trunk, and hood are closed.</li>
      <li>Park your car within one building to the left or right of your registered address.</li>
      <li>If your car’s color or license plate has changed, just let us know on WhatsApp.</li>
      <li>-If your car has a cover, kindly remove it so we can identify and wash it.</li>
      <li>Our team will wash your car at any time within the time your car will be available from and the time it needs to be done by. 
      If the car will arrive later or needs to be used earlier than that time frame, please notify us before 10:00 PM on the same day via WhatsApp.</li>
    </ul>

    <h4>⚠️ When We Can’t Wash the Car</h4>
    <ul>
      <li>Open windows, sunroof, trunk, or hood at the time of service.</li>
      <li>Car is parked outside the allowed area (not within one building of your location).</li>
      <li>License plate or color changed without prior notice.</li>
      <li>Car is in a garage with direct building access.</li>
      <li>-Car is covered at the time of the wash.</li>
      <li>Car is not present during the time range provided, and we were not informed before 10:00 PM.</li>
      <li>Rainy weather that prevents safe washing.</li>
    </ul>

    <h4>📱 Communication</h4>
    <p>All service-related updates, changes, or notifications will be sent through WhatsApp. Please make sure your number is active and reachable.</p>
    <a id="sbtn" href="#" onclick="togglePolicy(event)">Accept</a>
  </div>
</div>
<button type="button" class="btn" id="nxtbtn">Proceed to Payment</button>
<button type="button" class="btn back">Back</button>

    </div>
    

    <!-- Step 5: Confirmation -->
    <div id="step5" class="step hidden text-center">
      <h2>LOADING PAYMENT GATEWAY....</h2>
    </div>

  </form>
</div>
</div>
</div>

<!-- Footer -->
  <footer class="bg-black text-white py-8">
    <div class="containerft text-center">
      <p>&copy; <span id="year"></span> Optimum Auto. All rights reserved.</p>
    </div>

<p>
    <i class="fa-solid fa-location-dot" style="color:gold;"></i>
    Cairo, Egypt</p>

    <!-- Policy Toggle Buttons -->
    <div class="policy-buttons flex flex-wrap justify-center gap-3 mb-4">
      <button type="button" class="footer-policy-btn">Privacy Policy</button>
      <button type="button" class="footer-policy-btn">Refund & Exchange</button>
      <button type="button" class="footer-policy-btn">Terms & Conditions</button>
    </div>

    <!-- Policy Content Sections -->
     <!--privacy-->
<div class="policy-container">
  <div class="policy-item">
    <div class="policy-content hidden">
      
      <h3>Privacy Policy</h3>
      <p>
        At Optimum Auto, your privacy is important to us. This Privacy Policy outlines how we collect, use, and protect your personal information when you use our services.
      </p>
      <h4>Information We Collect</h4>
      <p>
        We collect only the information necessary to deliver our services effectively and securely:
      </p>
      <ul>
        <li>-Full Name</li>
        <li>-Phone Number</li>
        <li>-Address</li>
        <li>-Car Details</li>
        <li>-Number of Cars</li>
        <li>-Building Number</li>
        <li>-Email Address</li>
      </ul>
      <h4>How We Use Your Information</h4>
      <p>
        Your data is used strictly for operational purposes:
      </p>
      <ul>
        <li>-To manage your car wash subscription</li>
        <li>-To schedule and deliver service to your specified location</li>
        <li>-To send service-related notifications (e.g., reminders or updates) via WhatsApp</li>
        <li>-To process payments securely through our payment provider (see below)</li>
      </ul>
      <p>
        We do not send promotional content and we do not share your information with any third parties.
      </p>
      <h4>Payment Processing</h4>
      <P>
        When you complete a payment through our platform, a limited set of billing data is securely shared with our payment provider, Paymob, for transaction processing purposes. This includes:
      </P>
      <ul>
        <li>-First Name</li>
        <li>-Last Name</li>
        <li>-Phone Number</li>
        <li>-Building Number</li>
        <li>-Email Address</li>
      </ul>
      <p>
        This data is used solely to identify the payment and ensure proper service delivery. It is not used for marketing or any other purposes.
      </p>
      <h4>Data Storage & Security</h4>
      <p>
        All user data is stored in protected files and handled with confidentiality. We do not use cookies or third-party trackers. Some data may be stored in your browser’s local storage for smoother interaction on our website — none of this is shared externally.
      </p>
      <h4>Your Rights</h4>
      <p>You have full control over your data:</p>
      <ul>
        <li>-You may request to update or correct your information at any time.</li>
        <li>-You may request to delete your data from our system.</li>
      </ul>
      <p>To do so, simply contact us via WhatsApp or email.</p>
      <h4>Policy Updates</h4>
      <p>We may update this Privacy Policy if needed to reflect changes in service. We will notify you of any major updates.</p>
      <br>
      <h5>If you have any questions or concerns regarding your privacy, feel free to reach out to us via the methods listed on our  <a href="contact.html" style="color: goldenrod;">Contact Page.</a></h5>
      <button id="fc-btn" onclick="cl()">Accept</button>
    </div>
  </div>

  <div class="policy-item">
    <div class="policy-content hidden">
      <h3>Refund & Exchange Policy</h3>
      <P>
        At Optimum Auto, we aim to provide a seamless and reliable service. To ensure transparency and fairness. Please review the following terms regarding refunds and subscription changes:
      </P>
      <h4>Refunds</h4>
      <p>
        <strong>Payment Errors:</strong> If a customer is charged incorrectly due to a system or billing error, a full refund will be issued upon verification.
      </p>
      <p>
        <strong>Cancellation Within First 2 Weeks:</strong> If a customer chooses to cancel their subscription within 14 days from the start date, they are eligible for a refund of 50% of the total amount paid.
      </p>
      <p>
        <strong>Cancellation After 2 Weeks:</strong> Requests for cancellation made after the initial two-week period from the start date are not eligible for a refund.
      </p>
      <h4>Plan Changes</h4>
      <p>
        <strong>Upgrading from 3-Day to 6-Day Plan:</strong>
        <br>-Customers may upgrade their plan within 7 days of the subscription start date, with the price difference applied accordingly.
        <br>-After this period, upgrades can still be made, but we recommend scheduling them for the upcoming month, as it would be more cost-effective for the customer.
        <br>-The upgraded plan will be applied starting from the following week to ensure proper planning and availability.
      </p>
      <p>
        <strong>Downgrading from 6-Day to 3-Day Plan:</strong>
        <br>-Downgrades can be requested within the first 3 days of the subscription start date for a refund of the price difference.
        <br>-After that, customers may still downgrade at any time, but no refund will be issued. It is recommended to apply such changes for the upcoming month.
        <br>-The change to the downgraded plan will be processed and applied instantly after confirmation.
      </p>
      <h4>Missed Washes</h4>
      <p>
        We strive to maintain reliable service and consistent scheduling. In the rare case that a wash cannot be completed due to unexpected or uncontrollable circumstances (such as weather or logistical challenges), we will notify the customer in advance via WhatsApp, and do our best to minimize any disruption to the service. Our team always aims to operate with professionalism and transparency.
      </p>
      <br>
      <h5>For any refund or exchange inquiries, feel free to reach out to us via the methods listed on our <a href="contact.html" style="color: goldenrod;">Contact Page.</a></h5>
      <button id="fc-btn" onclick="cl()">Accept</button>
    </div>
  </div>


  <div class="policy-item">
    <div class="policy-content hidden">

      <h4>🚘 Optimum Auto – Service Terms & What You Should Know</h4>
    <p>To keep your experience smooth and your car looking its best, here are a few simple things to know before each wash. Nothing complicated — just easy steps to help us deliver the best results.</p>

    <h4>✅ What You Should Do</h4>
    <ul>
      <li>-Please make sure all windows, sunroof, trunk, and hood are closed.</li>
      <li>-Park your car within one building to the left or right of your registered address.</li>
      <li>-If your car’s color or license plate has changed, just let us know on WhatsApp.</li>
      <li>-If your car has a cover, kindly remove it so we can identify and wash it.</li>
      <li>-Our team will wash your car at any time within the time your car will be available from and the time it needs to be done by. 
      If the car will arrive later or needs to be used earlier than that time frame, please notify us before 10:00 PM on the same day via WhatsApp.</li>
    </ul>

    <h4>⚠️ When We Can’t Wash the Car</h4>
    <ul>
      <li>-Open windows, sunroof, trunk, or hood at the time of service.</li>
      <li>-Car is parked outside the allowed area (not within one building of your location).</li>
      <li>-License plate or color changed without prior notice.</li>
      <li>-Car is in a garage with direct building access.</li>
      <li>-Car is covered at the time of the wash.</li>
      <li>-Car is not present during the time range provided, and we were not informed before 10:00 PM.</li>
      <li>-Rainy weather that prevents safe washing.</li>
    </ul>

    <h4>📱 Communication</h4>
    <p>All service-related updates, changes, or notifications will be sent through WhatsApp. Please make sure your number is active and reachable.</p>
    <br>
    <h5>For any questions, issues, or feedback,  feel free to reach out to us via the methods listed on our <a href="contact.html" style="color: goldenrod;">Contact Page.</a></h5>
    <button id="fc-btn" onclick="cl()">Accept</button>
    </div>
  </div>
</div>

</footer>

<script>
    //accept policy
function cl(){
  const policies = document.querySelectorAll(".policy-content");
  policies.forEach(policy => {
    policy.classList.add("hidden");
    });

}
//policies
document.querySelectorAll(".footer-policy-btn").forEach((btn, index) => {
  btn.addEventListener("click", () => {
    const policies = document.querySelectorAll(".policy-content");
    
    // Hide all policy sections first
    policies.forEach(policy => {
      policy.classList.add("hidden");
    });

    // Show the one that matches the clicked button
    if (policies[index]) {
      policies[index].classList.remove("hidden");
    }
  });
});
//year
document.getElementById("year").textContent = new Date().getFullYear();
  const steps = document.querySelectorAll(".step");
  let currentStep = 0;
  const formData = JSON.parse(localStorage.getItem("optimumAuto")) || {};

  // Populate form from localStorage
  Object.keys(formData).forEach(key => {
    const el = document.querySelector(`[name='${key}']`);
    if (el) el.value = formData[key];
  });

function hasForbiddenStart(value) {
  if (!value) return false;
  const trimmed = value.trim();
  return ["=", "+", "-", "@"].includes(trimmed.charAt(0));
}

function validateNoForbiddenStart() {
  const inputs = document.querySelectorAll("input, textarea, select");
  for (let input of inputs) {
    if (hasForbiddenStart(input.value)) {
      alert(`${input.name || input.id} cannot start with =, +, - or @`);
      return false;
    }
  }
  return true;
}



  const durationSelect = document.getElementById("durationSelect");
const startDateSelect = document.getElementById("startDateSelect");
const endDateDisplay = document.getElementById("endDateDisplay");
  const select = document.querySelector("select[name='startDate']");
  generateFridays(select);
  

// Function to calculate end date
function calculateEndDate(startDate, weeks) {
  const date = new Date(startDate);
  const daysToAdd = (weeks * 7) ; // end date should be Thursday
  date.setDate(date.getDate() + daysToAdd);
  return date.toLocaleDateString("en-US", {
    
    year: "numeric",
    month: "long",
    day: "numeric"
  });
}

// Function to update end date display
function updateEndDate() {
  const startDateValue = startDateSelect.value;
  const weeks = parseInt(durationSelect.value, 10);

  if (startDateValue && weeks) {
    const endDate = calculateEndDate(startDateValue, weeks);
    endDateDisplay.textContent = `${endDate}`;
    
  } else {
    endDateDisplay.textContent = "";
    
  }
}

// Update end date when either field changes
durationSelect.addEventListener("change", updateEndDate);
startDateSelect.addEventListener("change", updateEndDate);

  function generateFridays(selectElement) {
    selectElement.options.length = 1;
    const today = new Date();
    let currentDate = new Date(today);
    const currentDay = today.getDay();
    let daysToAdd = (5 - currentDay + 7) % 7 || 7;
    currentDate.setDate(today.getDate() + daysToAdd);

    for (let i = 0; i < 52; i++) {
      const option = document.createElement("option");
      option.value = currentDate.toISOString().split("T")[0];
      option.textContent = currentDate.toLocaleDateString("en-US", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric"
      });
      selectElement.appendChild(option);
      currentDate.setDate(currentDate.getDate() + 7);
    }

    if (formData.startDate){
      selectElement.value = formData.startDate;
       updateEndDate();
      } 
  }

  document.querySelectorAll(".btn").forEach(btn => {
  btn.addEventListener("click", (e) => {

    if (!validateNoForbiddenStart()) {
  return; // stop here, don’t go to next step
} 
    const direction = e.target.id === "nxtbtn" ? 1 : -1;

    if (direction === 1) {
  if (currentStep === 3) { // Summary step
    const checkbox = document.getElementById("policyCheckbox");
    if (!checkbox?.checked) {
      alert("You must agree to the policies before continuing.");
      return;
    }
  }

  if (!validateStep(currentStep)) return;
}

    // Hide current step
    steps[currentStep].classList.add("hidden");

    // Update currentStep safely
    if (direction === 1 && currentStep < steps.length - 1) {
      currentStep++;
    } else if (direction === -1 && currentStep > 0) {
      currentStep--;
    }

    if (direction === -1 && currentStep === 2) {
      const container = document.getElementById("summaryContainer");
      container.innerHTML = ""; // Clear summary on back navigation
    }

    // Show new step
    steps[currentStep].classList.remove("hidden");

    // Run step-specific functions
    if (currentStep === 1) generateFridays(select); // Start Date
    if (currentStep === 2) generateCarFields(); // Car Details
    if (currentStep === 3) {
      const cars = collectCars();
      generateSummary(cars); // Summary
    }
    if (currentStep === 4) {
      saveData(); // Save + Send Data
      const submission = buildSubmissionObject();
      sendDataToGoogleSheet(submission);
      shitstart();
      setTimeout(() => {
        steps[currentStep].classList.add("hidden")
       currentStep--; // Go back to summary step
        steps[currentStep].classList.remove("hidden");
      }, 20000);
      
    }
    
  });
});

  function validateStep(stepIndex) {
    const step = steps[stepIndex];
    const inputs = step.querySelectorAll("input, select");
    for (const input of inputs) {
      if (!input.checkValidity()) {
        input.reportValidity();
        return false;
      }
    }
    return true;
  }

  function togglePolicy(e) {
  e.preventDefault();
  const policyBox = document.getElementById("policyBox");
  policyBox.style.display = policyBox.style.display === "none" ? "block" : "none";
}

//get back from loading


  function generateCarFields() {
    const container = document.getElementById("carDetailsContainer");
    const totalCars = Math.min(parseInt(document.querySelector("[name='totalCars']").value) || 1, 15);

    // Save existing values before clearing
    const savedCars = [];
    for (let i = 0; i < totalCars; i++) {
      const brand = container.querySelector(`[name='car[${i}][brand]']`)?.value || "";
      const model = container.querySelector(`[name='car[${i}][model]']`)?.value || "";
      const color = container.querySelector(`[name='car[${i}][color]']`)?.value || "";
      const plate = container.querySelector(`[name='car[${i}][plate]']`)?.value || "";
      const plan = container.querySelector(`[name='car[${i}][plan]']`)?.value || "";
      const availableFrom = container.querySelector(`[name='car[${i}][availableFrom]']`)?.value || "";
      const doneBy = container.querySelector(`[name='car[${i}][doneBy]']`)?.value || "";
      const notes = container.querySelector(`[name='car[${i}][notes]']`)?.value || "";

      savedCars.push({ brand, model, color, plate, plan, availableFrom, doneBy, notes });
    }

    container.innerHTML = "";

    for (let i = 0; i < totalCars; i++) {
      const div = document.createElement("div");
      div.className = "car-section";
      div.innerHTML = `
        <h4>Car ${i+1}</h4>
        <input type="text" name="car[${i}][brand]" placeholder="Brand" value="${savedCars[i]?.brand || ''}" required />
        <input type="text" name="car[${i}][model]" placeholder="Model" value="${savedCars[i]?.model || ''}" required />
        <input type="text" name="car[${i}][color]" placeholder="Color" value="${savedCars[i]?.color || ''}" required />
        <input type="text" name="car[${i}][plate]" placeholder="Plate Number" value="${savedCars[i]?.plate || ''}" required />

        <label>
          Wash Frequency:
          <select name="car[${i}][plan]" required>
            <option value="">Select Plan</option>
            <option value="6" ${savedCars[i]?.plan === "6" ? "selected" : ""}>6 Days a Week</option>
            <option value="3" ${savedCars[i]?.plan === "3" ? "selected" : ""}>3 Days a Week</option>
          </select>
        </label>

        <label>
  Available From:
  <select name="car[${i}][availableFrom]" id="availableFrom-${i}">
    ${Array.from({ length: 5 }, (_, i) => i + 1).map(h => `<option value="${h}:00 AM">${h}:00 AM</option>`).join("")}
  </select>
</label>

<label>Need Done By:
  <select name="car[${i}][doneBy]" id="doneBy-${i}">
    <option value="">Select done by</option>
    ${Array.from({ length: 7 }, (_, i) => i + 2).map(h => 
      h === 8 ? 
        `<option selected value="${h}:30 AM">${h}:30 AM</option>` : 
        `<option value="${h}:30 AM">${h}:30 AM</option>`
    ).join("")}
  </select>
</label>

        <textarea name="car[${i}][notes]" placeholder="Notes about this car (optional)">${savedCars[i]?.notes || ''}</textarea>
      `;
      container.appendChild(div);
      setupTimeValidation(i);
    }

    // Restore time selections
    for (let i = 0; i < totalCars; i++) {
      const availableFromInput = container.querySelector(`[name='car[${i}][availableFrom]']`);
      if (availableFromInput && savedCars[i]?.availableFrom) availableFromInput.value = savedCars[i].availableFrom;

      const doneByInput = container.querySelector(`[name='car[${i}][doneBy]']`);
      if (doneByInput && savedCars[i]?.doneBy) doneByInput.value = savedCars[i].doneBy;
    }
  }

  function collectCars() {
    const container = document.getElementById("carDetailsContainer");
    const totalCars = Math.min(parseInt(document.querySelector("[name='totalCars']").value) || 1, 15);
    const cars = [];

    for (let i = 0; i < totalCars; i++) {
      const brand = container.querySelector(`[name='car[${i}][brand]']`)?.value || "";
      const model = container.querySelector(`[name='car[${i}][model]']`)?.value || "";
      const color = container.querySelector(`[name='car[${i}][color]']`)?.value || "";
      const plate = container.querySelector(`[name='car[${i}][plate]']`)?.value || "";
      const plan = container.querySelector(`[name='car[${i}][plan]']`)?.value || "";
      const availableFrom = container.querySelector(`[name='car[${i}][availableFrom]']`)?.value || "";
      const doneBy = container.querySelector(`[name='car[${i}][doneBy]']`)?.value || "";
      const notes = container.querySelector(`[name='car[${i}][notes]']`)?.value || "";

      if (brand || model || color || plate || plan) {
        cars.push({
          brand,
          model,
          color,
          plate,
          plan,
          availableFrom,
          doneBy,
          notes
        });
      }
    }

    return cars;
  }

  function calculatePrice(cars = []) {
    let totalPrice = 0;
    let originalPrice = 0;

    const sixDayCars = cars.filter(c => c.plan === "6");
    const threeDayCars = cars.filter(c => c.plan === "3");
    originalPrice= (sixDayCars.length * 700)+(threeDayCars.length * 400);
    if(sixDayCars.length === 1 && threeDayCars.length === 1 ){
      totalPrice += 1000;
    } else if(sixDayCars.length >= 2 && threeDayCars.length === 1){
      totalPrice +=  (sixDayCars.length * 550 ) + 350 ;
    }else if(sixDayCars.length === 1 && threeDayCars.length >= 2){
      totalPrice += (threeDayCars.length * 300 ) + 650;
    }else{
    if (sixDayCars.length === 1) {
      totalPrice += 700;
    } else if (sixDayCars.length >= 2) {
      totalPrice += 550 * sixDayCars.length;
    } 
    if (threeDayCars.length === 1) {
      totalPrice += 400;
    } else if (threeDayCars.length >= 2) {
      totalPrice += 300 * threeDayCars.length;
    } 
    }
     const pricePW=totalPrice/((threeDayCars.length*12)+(sixDayCars.length*24));
    return {
      totalPrice: parseFloat(totalPrice.toFixed(2)),
      originalPrice: parseFloat(originalPrice.toFixed(2)),
       pricePW: parseFloat(pricePW.toFixed(2))
    };
  }
   
  function generateSummary(cars) {
  
  const container = document.getElementById("summaryContainer");
  

  // Show customer info
  const fields = ["firstName", "lastName", "phone", "area", "buildingNumber", "totalCars", "email"];
  fields.forEach(name => {
    const val = document.querySelector(`[name='${name}']`)?.value || "";
    if (val) {
      if (name === "firstName"){
       container.innerHTML += `<div class="summary-item"><strong>First Name:</strong> ${val}</div>`; 
      }else if(name === "lastName"){
       container.innerHTML += `<div class="summary-item"><strong>Last Name:</strong> ${val}</div>`; 
      }else if(name === "buildingNumber"){
       container.innerHTML += `<div class="summary-item"><strong>Building Number:</strong> ${val}</div>`; 
      }else if(name === "totalCars"){
       container.innerHTML += `<div class="summary-item"><strong>Total Cars:</strong> ${val}</div>`; 
      }else{
        container.innerHTML += `<div class="summary-item"><strong>${toTitleCase(name)}:</strong> ${val}</div>`;
      }
    }
  });
    //show duration
    const duration = document.querySelector("[name='duration']")?.value || "";
if (duration) {
  container.innerHTML += `<div class="summary-item"><strong>Duration :</strong> ${duration} Weeks</div>`;
}//show start date
    const startDate = document.querySelector("[name='startDate']")?.value || "";
    const sstartDate = new Date(startDate);
    const fstartDate = sstartDate.toLocaleDateString("en-US", {year: "numeric",month: "long",day: "numeric"});
    if (startDate) {
  container.innerHTML += `<div class="summary-item"><strong>Start Date:</strong> ${fstartDate}</div>`;
}//show end date
    const endDate =document.querySelector("[id='endDateDisplay']").textContent;
if (endDate) {
  container.innerHTML += `<div class="summary-item"><strong>Renewal Date:</strong> <span>${endDate}</span></div>`;
}


  // Show car details
  cars.forEach((car, idx) => {
    let carHTML = `<div class="summary-car">`; // wrapper for car section
carHTML += `<h4>Car ${idx + 1}</h4>`;       // heading

carHTML += `<div class="summary-car-fields">`; // wrapper for fields
for (const key in car) {
  if(key === "availableFrom"){
    carHTML += `<div class="summary-item"><strong>Available From:</strong> ${car[key]}</div>`;
  }else if(key === "doneBy"){
    carHTML += `<div class="summary-item"><strong>Done By:</strong> ${car[key]}</div>`;
  }else if(key === "plan"){
     carHTML += `<div class="summary-item"><strong>Frequency:</strong> ${car[key]} Days a Week </div>`;
  }else if(car[key]){
    carHTML += `<div class="summary-item"><strong>${toTitleCase(key)}:</strong> ${car[key]}</div>`;
  }
}
carHTML += `</div></div>`; // close both .summary-car-fields and .summary-car

// Append to container
container.innerHTML += carHTML;


    
  });

  // Calculate price
  const { totalPrice, originalPrice, pricePW } = calculatePrice(cars);
  const saved = (originalPrice - totalPrice).toFixed(2);

  

  // Generate suggestions based on car data
  const threeDayIndices = [];
  const sixDayIndices = [];

  cars.forEach((car, index) => {
    if (car.plan === "3") threeDayIndices.push(index + 1); // Car numbers start at 1
    else if (car.plan === "6") sixDayIndices.push(index + 1);
  });

  const totalCars = cars.length;
  let suggestion = "";

  if(threeDayIndices.length >= 1){
    const carsToSuggest = threeDayIndices.join(", ");
  if(totalCars === 1 && threeDayIndices.length === 1){
   suggestion = `
       <div style="font-size:0.9rem;color:black;background:rgb(228, 228, 228); padding:15px; border-left: 4px solid black; margin-top:15px;">
        <strong><i class="fa-regular fa-lightbulb" style="color:black;"></i> Recommendation:</strong>  If the car is part of your daily routine, the 6 Days a Week plan is made for it.
      </div>
    `;
  }else if(totalCars === 2 && threeDayIndices.length === 1){
    suggestion = `
       <div style="font-size:0.9rem;color:black;background:rgb(228, 228, 228); padding:15px; border-left: 4px solid black; margin-top:15px;">
        <strong><i class="fa-regular fa-lightbulb" style="color:black;"></i> Tip:</strong> You can upgrade Car(${carsToSuggest}) to the 6 Days a Week plan, and also drop the per wash cost to 22.92 EGP for only +100 EGP. .
      </div>
    `;
 }else if (totalCars > 2 && sixDayIndices.length === 1 && totalCars < 5) {
    suggestion = `
       <div style="font-size:0.9rem;color:black;background:rgb(228, 228, 228); padding:15px; border-left: 4px solid black; margin-top:15px;">
        <strong><i class="fa-regular fa-lightbulb" style="color:black;"></i> Tip:</strong> You can reduce the per wash cost to 22.92 EGP instead of ${pricePW} EGP by upgrading cars(${carsToSuggest}) to 6 Days a Week plan.
      </div>
    `;
  }
}


  // Add suggestion if any
  if (suggestion) {
    container.innerHTML += suggestion;
  }

  // Final price display
  if(totalPrice===originalPrice){
  container.innerHTML += `
    <hr>
    <div class="summary-item"><strong>Standard Price:</strong>  ${originalPrice} EGP</div>
    <div class="summary-item"><strong>Special Price:</strong><i class="fa-solid fa-xmark" style="margin-left:10px;" ></i></div>
    <div class="summary-item"><strong>Per Wash Cost:</strong>  ${pricePW} EGP</div>
  `;
  } else {
    container.innerHTML += `
    <hr>
    <div class="summary-item"><strong>Standard Price:</strong> <span class="strike"> ${originalPrice} EGP</span></div>
    <div class="summary-item"><strong>Special Price:</strong>  ${totalPrice} EGP</div>
    <div class="summary-item"><strong>Per Wash Cost:</strong>  ${pricePW} EGP</div>
  `;
  }
  container.innerHTML +=`<p class="note">*<button type="button" onclick="window.open('pricing.html?from=subscribe', '_blank')">View Pricing</button></p>`;


    document.getElementById("policyCheckbox").addEventListener("change", () => {
  document.getElementById("nextBtn").disabled = !document.getElementById("policyCheckbox").checked;
});
}

  function buildSubmissionObject() {
  const customerInfo = {
    firstName: document.querySelector("[name='firstName']")?.value || "",
    lastName: document.querySelector("[name='lastName']")?.value || "",
    phone: document.querySelector("[name='phone']")?.value || "",
    email: document.querySelector("[name='email']")?.value || "",
    area: document.querySelector("[name='area']")?.value || "",
    buildingNumber: document.querySelector("[name='buildingNumber']")?.value || "",
    totalCars: document.querySelector("[name='totalCars']")?.value || "",
    startDate: document.querySelector("[name='startDate']")?.value || "",
    duration: document.querySelector("[name='duration']")?.value || ""
  };

  const cars = collectCars();

  // Flatten car data into submission object dynamically
  const submission = { ...customerInfo };
  cars.forEach((car, index) => {
    submission[`car${index}Brand`] = car.brand;
    submission[`car${index}Model`] = car.model;
    submission[`car${index}Color`] = car.color;
    submission[`car${index}Plate`] = car.plate;
    submission[`car${index}Plan`] = car.plan;
    submission[`car${index}AvailableFrom`] = car.availableFrom;
    submission[`car${index}DoneBy`] = car.doneBy;
    submission[`car${index}Notes`] = car.notes;
  });

  submission.submittedAt = new Date().toLocaleString();
  return submission;
}
  async function sendDataToGoogleSheet(data) {

    try {
      const response = await fetch("https://google-sub-back-production.up.railway.app/subscribe", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(data)
})
.then(res => res.json())
.then(data => {
  if (data.success) {
  } else {
    console.error("Failed:", data.error);
  }
});


      
    } catch (error) {
      console.error("Error sending data:", error);
    }
  }

  function collectFormData() {
    const formData = {};
    const inputs = document.querySelectorAll("input, select, textarea");

    inputs.forEach(input => {
      if (input.name.includes("car[")) {
        const match = input.name.match(/car\$(\d+)\$\.(.+)/);
        if (match) {
          const index = match[1];
          const key = match[2];
          if (!formData.car) formData.car = [];
          if (!formData.car[index]) formData.car[index] = {};
          formData.car[index][key] = input.value;
        }
      } else {
        formData[input.name] = input.value;
      }
    });

    return formData;
  }

  function saveData() {
    const inputs = document.querySelectorAll("input, select, textarea");
    const data = {};

    inputs.forEach(input => {
      if (input.name.includes("car[")) {
        const match = input.name.match(/car\$(\d+)\$\.(.+)/);
        if (match) {
          const index = parseInt(match[1]);
          const key = match[2];
          if (!data.car) data.car = [];
          if (!data.car[index]) data.car[index] = {};
          data.car[index][key] = input.value;
        }
      } else {
        data[input.name] = input.value;
      }
    });

    localStorage.setItem("optimumAuto", JSON.stringify(data));
  }

  function restartForm() {
    localStorage.removeItem("optimumAuto");
    location.reload();
  }

  function toTitleCase(str) {
    return str.replace(/\w+/g, w => w[0].toUpperCase() + w.slice(1));
  }
  function setupTimeValidation(carIndex) {
    const availableFromSelect = document.querySelector(`#availableFrom-${carIndex}`);
    const doneBySelect = document.querySelector(`#doneBy-${carIndex}`);

    if (!availableFromSelect || !doneBySelect) return;

    // Helper to extract hour from time string like "1 Am"
    function getHour(timeStr) {
        // Handles "1 Am", "2 Am", etc.
        return parseInt(timeStr);
    }

    // Populate doneBy options based on availableFrom
    function populateDoneByOptions(availableHour) {
        doneBySelect.innerHTML = ""; // Clear existing options

        const minDoneByHour = availableHour + 3;
        let has830 = false;

        for (let h = minDoneByHour; h <= 8; h++) {
            const option = document.createElement("option");
            option.value = `${h}:30 AM`;
            option.textContent = `${h}:30 AM`;
            if (h === 8) {
                option.selected = true;
                has830 = true;
            }
            doneBySelect.appendChild(option);
        }

        // If no valid options
        if (minDoneByHour > 8) {
            const option = document.createElement("option");
            option.disabled = true;
            option.textContent = "No valid time";
            doneBySelect.innerHTML = "";
            doneBySelect.appendChild(option);
            doneBySelect.disabled = true;
        } else {
            doneBySelect.disabled = false;
            // If 8:30 AM is not in the options, select the last available option
            if (!has830 && doneBySelect.options.length > 0) {
                doneBySelect.options[doneBySelect.options.length - 1].selected = true;
            }
        }
    }

    // Initial population
    const initialAvailableHour = getHour(availableFromSelect.value);
    populateDoneByOptions(initialAvailableHour);

    // On change
    availableFromSelect.addEventListener("change", () => {
        const selectedHour = getHour(availableFromSelect.value);
        populateDoneByOptions(selectedHour);
    });
}


   function calcorder(){
    const cars = collectCars();
    const { totalPrice, originalPrice } = calculatePrice(cars);
    return totalPrice;

   }
   //async function oplink(){
     //var lnk = await shitstart();
     //window.location.href = lnk;
    //window.open(lnk);
   //}
    
   async function shitstart() {
  const totalEGP = calcorder(); // use your existing calcorder() function
  const amount = totalEGP * 100;
  
  const billing_data = {
  first_name: document.querySelector("[name='firstName']").value,
  last_name: document.querySelector("[name='lastName']").value,
  phone_number: document.querySelector("[name='phone']").value,
  email: document.querySelector("[name='email']").value,
  building: document.querySelector("[name='buildingNumber']").value,
  apartment: "NA",
  floor: "NA",
  street: "NA",
  shipping_method: "NA",
  postal_code: "NA",
  city: "Cairo",
  country: "EG",
  state: "Cairo"
};

  try {
    const response = await fetch("https://paymob-backend-production.up.railway.app/start-checkout", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ amount, billing_data })
    });

    const result = await response.json();
   
    if (result.checkout_url) {
      window.location.href = result.checkout_url;
      //window.open(result.checkout_url, "_blank");
      
    } else {
      alert("Payment failed: " + result.error);
    }

  } catch (err) {
    console.error("Checkout error:", err);
    alert("Could not start checkout.");
  }
}





</script>
</body>
</html>
